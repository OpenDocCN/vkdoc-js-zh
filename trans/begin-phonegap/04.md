## 第四章

## 通过 jQuery Mobile 使用 PhoneGap

虽然 PhoneGap 提供了一个允许 JavaScript 应用程序访问原生手机功能的平台，但还有许多其他因素有助于移动 HTML 应用程序。

移动 HTML 应用程序最重要的部分之一是 UI。您可以使用 HTML、JavaScript 和 CSS 手工编写整个 UI。然而，任何 web 开发人员都会告诉您，这种方法存在许多问题，包括以下问题:

1.  不是所有的浏览器都一样；你需要一个跨浏览器的框架才能成功。即使大多数移动浏览器都是基于 webkit 的，最好还是使用一个框架，从开发者那里抽象出浏览器的差异。
2.  如果您是手工编码，您的大部分代码将是绘制 UI、修改 DOM 和进行 Ajax 调用。一个让你少写多做的框架将会帮助你真正关注业务逻辑。
3.  创建美观的 HTML 用户界面需要设计师的技能。同时，大多数移动客户端都有预定义的主题或模式。如果一个框架能提供开箱即用的好看的 UI，这将对开发者有所帮助。这样，开发人员可以专注于业务逻辑。

话虽如此，使用 PhoneGap 编写 UI 的最简单的框架之一是 jQueryMobile。首先，jQueryMobile 是建立在非常流行的 jQuery 之上的。众所周知，jQuery 是一个 JavaScript 库，可以提高开发人员的工作效率，并帮助开发人员实现跨浏览器兼容性。同时，jQuery 提供了许多免费的插件来做很多事情。

jQueryMobile 是一个为移动 UI 构建的 UI 框架。它有一个声明式 UI，这意味着你不必用 JavaScript 编写你的 UI，而是可以用 HTML 声明它。jQueryMobile 还提供了一个开箱即用的非常漂亮的 UI。

所有这些使得 jQueryMobile 成为最容易使用的 JavaScript UI 框架，也是最适合中等复杂程度的移动 UI 的框架。

话虽如此，jQueryMobile 为智能手机和平板电脑提供了相同的 UI。如果你的需求不一样，需要智能手机和平板电脑不同的布局，那就看[第五章](05.html#ch5)。

### 熟悉 jQuery

jQuery 是最好的 JavaScript 库之一，它可以帮助您执行 Ajax 调用、在 HTML DOM 中搜索特定元素以及修改 DOM。它也有自己的插件框架。最棒的是它的跨浏览器框架，消除了浏览器差异的困扰。可以参考下面的 jQuery 教程:`[www.w3schools.com/jquery/default.asp](http://www.w3schools.com/jquery/default.asp)`。

#### jQuery 初始化

jQuery 初始化是一个两步过程。

1.  在 HTML 页面中包含 jQuery JavaScript。
2.  声明一个回调，当 jQuery 的库被加载时，jQuery 将调用这个回调。

这是必要的，因为 HTML 页面可能包含许多文件，如 CSS、JavaScript 和图像。浏览器将下载所有这些资源，并开始执行所有的 JavaScript 块。如果在正确初始化之前开始使用 jQuery API 调用，将会出现错误。因此，您声明一个回调，这是我们的应用程序的入口点，jQuery 将调用这个回调并引导应用程序。

通常，当开发人员不使用 jQuery 时，他会按照以下方式编写代码:

`window.onload = function(){
     alert("Page Loaded");
}

When using jQuery the same code would look like follows:
<html>
     <head>
        //Step 1 – include jquery library
        <script type="text/javascript" src="jquery.js">

        </script>
        <script type="text/javascript">
                //Step 2 – Declare a callback for jquery to call when it loads
                $(document).ready(function() {
                    //Place to bootstrap your application
                    alert("jquery loaded");
                });
        </script>
    </head>

    <body>
        <h1>
            jQuery Demo
        </h1>
    </body>
</html>`

当您在任何浏览器中运行这段代码时，您会看到在页面加载时弹出一个警告。警告会说“jQuery loaded”

#### jQuery 选择器

既然您已经了解了如何初始化 jQuery 和注册 onload()方法，那么让我们继续了解如何查找 HTML DOM 元素。

通常，开发人员会使用以下代码来获得 id 为“占位符”的 div

`document.getElementById("placeholder").innerhtml = "hello world";`

在 jQuery 中，您可以将上面的函数写成

`$("#placeholder").html("hello world");`

jQuery 提供了许多定位 HTML 元素的方法。一个例子是$("#placeholder ")，它返回一个 jQuery 元素，包装 id 为" placeholder "的元素。一旦获得了这个 jQuery 包装器，就可以调用 jQuery 函数来操作 DOM。在上面的例子中，您将它的 HTML 内容更改为“hello world”

让我们参考一个代码示例来回顾一些其他有用的选择器示例:

`<html>

    <body>
        <h1 class="title">
            JQUERY SELECTOR Tutorial
        </h1>
        <p>
            simple paragraph
        </p>
        <p class="title">
            Paragraph with class title
        </p>
        <p>
            another paragraph
        </p>
        <ul id="selector">
            <li>
                Element based - $("p")
            </li>
            <li>
                Id based - $("#selector")
            </li>
            <li>
                CSS Class based - $(".title")
            </li>
            <li>
                Element + Class based - $("p.title");
            </li>
            <li>
                Element+ID+Position - $("ui#selectorli:first)
            </li>
        </ul>
    </body>

</html>`

##### 基于元素的选择器

`$("p")`选择所有段落:

`<p>simple paragraph</p>
<p class="title">Paragraph with class title</p>
<p>another paragraph</p>`

##### 基于 ID 的选择器

`$("#selector")`选择 id 为“选择器”的元素请记住，要搜索的 id 前面会添加#号。为此选择器选择了以下元素:

`<ul id="selector">`

##### 基于 CSS 的选择器

`$(".title")`选择具有类“title”的元素记住，一个“.”在类名之前调用以搜索该类的元素。为此选择器选择了以下元素:

`<h1 class=”title”>JQUERY SELECTOR Tutorial</h1>

<p class="title">Paragraph with class title</p>`

##### 选择器的组合

以下是一些如何混合和匹配选择器来定位特定元素的示例:

`$("p.title")`选择类别为“title”的段落元素，这将选择以下元素:

`<p class="title">Paragraph with class title</p>`

`$("ul#selector li:first")`用 id“选择器”从 UI 中选择第一个 li 元素这将选择以下元素:

`<li>Element based                    - $("p")</li>`

jQuery 选择器的完整列表可以在下面的链接中找到:`[www.w3schools.com/jquery/jquery_ref_selectors.asp](http://www.w3schools.com/jquery/jquery_ref_selectors.asp)`。

#### jQuery DOM 操控

首先，让我们看看如何从 HTML 中检索值。您可以检索元素或内部 HTML 的值。

如果您执行 javascript `$(ul#selector).html(),`，您将得到以下文本:

`<li>Element based                    - $("p")</li>
<li>Id based                             - $("#selector")</li>
<li>CSS Class based                 - $(".title")</li>
<li>Element + Class based       - $("p.title");</li>
<li>Element+ID+Position         - $("ui#selector li:first)</li>`

以下示例显示了如何从 jQuery 选择器结果中提取值。首先，这个例子展示了当您假设 jQuery 选择器只返回一个值时会发生什么。也就是说，假设`$("p")`只返回了一段。然后，您将尝试使用 html()函数获取段落的值。注意`$("p")`返回一个 jQuery 选择器，html()函数属于 jQuery 选择器。在这种情况下，jQuery 将对$("p ")选择器找到的第一个元素运行 html()方法。这意味着当你说`$("p").HTML(), $("p")`时，将定位如下的第一段，并给出值“简单段落”

`<p>simple paragraph</p>`

现在你知道`$("p")`应该给你很多值，因为在前一个例子中有很多段落，如下所示:

`<p>simple paragraph</p>
<p class="title">Paragraph with class title</p>
<p>another paragraph</p>`

为了迭代任何列表，jQuery 提供了一个方法:“each()”为了使用“each()”，您需要在 jQuery 选择器上调用它，就像我们的例子$(“p”)一样。“each()”方法有两个参数:第一个是索引(迭代中的位置)，第二个是该位置的实际条目。

因此，当你说$(“p”)的时候。each(function(index，element){})，元素是每个段落上实际的 jQuery 选择器。

`<script type="text/javascript">
$(document).ready(function() {
    alert("Simple extraction = " + $("p").html());

    $("p").each(function(index, element) {
        alert(index + " - '" + $(element).html() + "'");
    });

});
</script>`

现在，让我们继续修改 HTML DOM。我们将很快介绍操作 DOM 的最简单的方法。

当您执行下面的 JavaScript 时，它会将段落的内容修改为“更改为 123”

`<script type="text/javascript">
$(document).ready(function() {
    $("p.title").html("Changed to 123");
});
</script>`

jQuery HTML 操作的完整列表可以在`[www.w3schools.com/jquery/jquery_ref_html.asp](http://www.w3schools.com/jquery/jquery_ref_html.asp)`找到。

#### jQuery Ajax 调用

jQuery 为 Ajax 调用提供了许多有用的方法。

下面是一个对 URL 进行 Ajax GET 调用的例子。这是“少写多做”的经典例子。以下代码执行 Ajax GET 调用 service/employee/details.txt，并将内容放入 id 为“details”的 div 中:

`$.get("service/employee/details.txt", function (result) {
    $("div#details").html(result);
});`

以下是对 URL 进行 Ajax POST 调用的示例，发布数据{name:employeeName}:

`$.post("service/employee/details", {
    name: employeeName
}, function (result) {
    alert("Post successful");
});`

jQuery HTML 操作的完整列表可以在 `[www.w3schools.com/jquery/jquery_ref_ajax.asp](http://www.w3schools.com/jquery/jquery_ref_ajax.asp)`找到。

### 熟悉 jQueryMobile

jQueryMobile 通过提供一个通用的 UI 平台来开发跨许多流行的移动平台的移动应用程序，将 jQuery“少写多做”的概念推向了一个新的高度。

jQueryMobile 建立在非常流行和健壮的 jQuery 和 jQuery UI 框架之上。jQueryMobile 提供了现成的、可触摸的移动小部件，比如列表视图、带有后退按钮的标题、导航动画等等。这些小部件具有专业而精致的外观和感觉，使得开发现成的应用程序变得更加容易。

jQueryMobile 的主页是`[http://jquerymobile.com/](http://jquerymobile.com/)`。

而且，jQueryMobile 提供了五种开箱即用的主题供你选择。下面的示例展示了按钮在不同主题中的外观。总的来说，我们有五个主题——主题 a、主题 b、主题 c、主题 d 和主题 d——如图[图 4–1](#fig_4_1)所示。

![images](images/9781430239031_Fig04-01.jpg)

**图 4–1。 *jQueryMobile 主题***

此外，jQueryMobile 还为[表 4–1](#tab_4_1)中列出的平台提供坡度支持。

![Images](images/t0401.jpg)

### 在移动应用中包含 jQueryMobile

从`[http://jquerymobile.com/download/](http://jquerymobile.com/download/)`下载 jquery.mobile-1.0rc2.zip 并解压。解压缩后，您会看到如图[图 4–2](#fig_4_2)所示的文件夹结构。它包含两对 jQueryMobile JavaScript 和一个 CSS 文件。顾名思义，您可以使用。最小化生产中的 JavaScript 和 CSS 文件，因为它们是缩小的 JavaScript 和 CSS 文件。

除此之外，你还需要在手机应用程序中包含图片文件夹。

![images](images/9781430239031_Fig04-02.jpg)

**图 4–2。 *jQueryMobile 文件夹结构*T3】**

以下是 jQueryMobile 示例的 HTML 模板:

`<!DOCTYPE HTML>
<html>

    <head>
        <title>
            jQuery Mobile Demo
        </title>
        <link rel="stylesheet" type="text/css" href="jquery.mobile-1.0rc2.min.css"/>
        <script type="text/javascript" src="jquery-1.6.4.min.js"></script>
        <script type="text/javascript" src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        …
    </body>

</html>`

### jQueryMobile 声明式用户界面

声明式 UI 构建是 jQueryMobile 最好的部分。您不需要编写复杂的 JavaScript 代码来构建 UI。UI 构建就像添加带有一些 jQueryMobile 特定属性及其值的普通 HTML 元素一样。

#### 页面和对话框

您在上一节中看到了 HTML 模板。现在，您将向其中添加 jQueryMobile 布局和小部件。

您可以在 body 标记内的 div 元素中使用数据角色属性来声明页面。因此，在 body 标记中，您可以通过声明以下内容来声明许多页面:

`<div data-role="page"></div>`

同样，您可以通过将数据角色声明为“页眉”、“内容”和“页脚”来声明页面的组件以下是 jQueryMobile 中的一个页面示例:

`<div data-role="page">

    <div data-role="header"></div>

    <div data-role="content"></div>

    <div data-role="footer"></div>

</div>`

此处显示了一个完整的页面示例。

`<!DOCTYPE HTML>
<html>
    <head>
        <title>jQuery Mobile Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        <!-- Page Start-->
        <div data-role="page">
            <!-- Page Header Start -->
            <div data-role="header">
                <h1>Page Title</h1>
            </div>
            <!-- Page Header End -->

            <!-- Page Body Start -->
            <div data-role="content">
                <p>
                    Page content goes here.
                </p>
            </div>
            <!-- Page Body End -->

            <!-- Page Footer Start -->
            <div data-role="footer">
                <h4>
                    Page Footer
                </h4>
            </div>
            <!-- Page Footer End -->
        </div>
        <!-- Page End -->
    </body>

</html>`

在浏览器中运行该 html 时，会显示一个如[图 4–3](#fig_4_3)所示的屏幕。

![images](images/9781430239031_Fig04-03.jpg)

**图 4–3。 *jQueryMobile pages***

现在，您已经了解了 jQueryMobile 中页面的概念，让我们来看一个拥有多个页面或对话框的场景。

典型的应用程序有多个页面和对话框。jQueryMobile 最棒的一点是，您可以在同一个 HTML 页面中定义所有这些不同的页面和对话框。

下面是怎么做的。在一个 HTML 页面中定义多个 div，并赋予它们以下内容:

1.  一个名为 data-role 的属性设置为 page。这看起来像这样:data-role="page "
2.  一个名为“id”的属性，用于在代码中标识它们

您可以使用链接和按钮导航到这些页面和对话框。最简单的方法是执行以下操作:

1.  将 href 定义为#+ <<id of="" the="" page="" box="">></id>
2.  给该链接一个 data-role="button "

注意，页面和对话框的声明是相同的。事实上，没有什么叫做对话框，但是你可以在弹出窗口中加载一个页面作为对话框。

下面是一个页面链接的示例。当单击此链接时，会转换到 id 为“page2”的页面。还要注意，因为链接被赋予了 data-role="button "，所以它看起来像一个按钮。

`<a data-role="button" href="#page2">Page Navigation</a>`

将页面作为对话框打开与导航到页面非常相似。您只需要向链接添加两个属性:

1.  data-rel="dialog "
2.  data-transition="pop "(这是动画效果)

`<a data-role="button" href="#dialog1"  data-rel="dialog" data-transition="pop">Open Dialog </a>`

这里有一个完整的例子供你尝试。[图 4–4](#fig_4_4)显示的是“主”页面，[图 4–5](#fig_4_5)显示的是“第二页”页面，[图 4–6](#fig_4_6)显示的是“对话 1”页面，相当于一个对话框:

`<!DOCTYPE html>
<html>

    <head>
        <title>jQuery Mobile Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        <!-- Main Page-->
        <div data-role="page" id="main">
            <div data-role="header">
                <h1>
                    Main Page
                </h1>
            </div>
            <div data-role="content">
                <h1>
                    Page Nav and Dialog Example
                </h1>
                <a data-role="button" href="#page2">Page Navigation</a>
                <a data-role="button" href="#dialog1" data-rel="dialog" data- transition="pop">Open Dialog </a>
            </div>
            <div data-role="footer">
                <h4>
                    Main Page Footer
                </h4>
            </div>
        </div>
        <!-- First Page End -->
        <!-- Second Page-->
        <div data-role="page" id="page2" data-add-back-btn=”true”>
            <div data-role="header">
                <h1>
                    Second Page
                </h1>
            </div>
            <div data-role="content">
                <h1>
                    Second Page
                </h1>
            </div>
            <div data-role="footer">
                <h4>
                    Click back to go back to main page
                </h4>
            </div>
        </div>
        <!-- Second Page End -->
        <!-- Dialog -->
        <div data-role="page" id="dialog1">
            <div data-role="header">
                <h1>
                    Dialog Title
                </h1>
            </div>
            <div data-role="content">
                v
                <h1>
                    Dialog body
                </h1>
            </div>
            <div data-role="footer">
                <h4>
                    Click close button to go back to main page
                </h4>
            </div>
        </div>
        <!-- Dialog End -->
    </body>

</html>` ![images](images/9781430239031_Fig04-04.jpg)

**图 4–4。*jquerymobile page navigation***

![images](images/9781430239031_Fig04-05.jpg)

**图 4–5。*jquerymobile page navigation***

![images](images/9781430239031_Fig04-06.jpg)

**图 4–6。 *jQueryMobile 对话框*T3】**

#### 工具栏和按钮

在 jQueryMobile 中，有两种类型的工具栏:

1.  标题栏
2.  页脚栏

一般来说，创建工具栏就像在标题栏或页脚栏中声明一些按钮一样简单。这在[图 4–7](#fig_4_7)中进行了描述。

`<!DOCTYPE html>
<html>

    <head>
        <title>jQuery Mobile Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        <!-- Main Page-->
        <div data-role="page" id="main">
            <div data-role="header" data-position="inline">
                <a href="index.html" data-icon="delete">Cancel</a>
                <h1>
                    Edit Contact
                </h1>
                <a href="index.html" data-icon="check">Save</a>
            </div>
            <div data-role="content">
                <h1>
                    Header Footer Toolbar Example
                </h1>
            </div>
            <div data-role="footer" class="ui-bar">
                <a href="index.html" data-role="button" data- icon="delete">Remove</a>
                <a href="index.html" data-role="button" data-icon="plus">Add</a>
                <a href="index.html" data-role="button" data-icon="arrow-
u">Up</a>
                <a href="index.html" data-role="button" data-icon="arrow-
d">Down</a>
            </div>
        </div>
        <!-- First Page End -->
    </body>

</html>` ![images](images/9781430239031_Fig04-07.jpg)

**图 4–7。 *jQueryMobile 工具栏和按钮***

#### 表格元素

jQueryMobile 中的表单元素是典型的 HTML 表单元素——它们只是看起来不同。这意味着您可以使用您的 HTML JavaScript 技能来呈现好看、精美的 jQueryMobile 小部件，并使用传统的事件处理技术来快速编写您的移动 web 应用程序。

让我们看几个表单元素的例子。在第一个例子中，我们使用了一个输入文本、一个文本区域和一个搜索框。对于所有这些，都分配了一个标签。它们被包装在一个字段集中，形成一组标签和相关的小部件。请参见[Figure 4–8](#fig_4_8)以了解表单元素在 jQueryMobile 中的外观。

`<!DOCTYPE html>
<html>

    <head>
        <title>jQuery Mobile Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        <!-- Main Page-->
        <div data-role="page" id="main">
            <div data-role="header" data-position="inline">
                <a href="index.html" data-icon="delete">Cancel</a>
                <h1>
                    Edit Contact
                </h1>
                <a href="index.html" data-icon="check">Save</a>
            </div>
            <div data-role="content">
                <form action="#" method="get">
                    <h2>
                        Simple Form Elements
                    </h2>
                    <div data-role="fieldcontain">
                        <label for="name">
                            Text Input:
                        </label>
                        <input type="text" name="name" id="name" value="" />
                    </div>
                    <div data-role="fieldcontain">
                        <label for="textarea">
                            Textarea:
                        </label>
                        <textarea cols="40" rows="8" name="textarea" id="textarea">
                        </textarea>
                    </div>
                    <div data-role="fieldcontain">
                        <label for="search">
                            Search Input:
                        </label>
                        <input type="search" name="password" id="search" value="" />
                    </div>
                </form>
            </div>
            <div data-role="footer" class="ui-bar">
                <a href="index.html" data-role="button" data- icon="delete">Remove</a>
                <a href="index.html" data-role="button" data-icon="plus">Add</a>
                <a href="index.html" data-role="button" data-icon="arrow-
u">Up</a>
                <a href="index.html" data-role="button" data-icon="arrow-
d">Down</a>
            </div>
        </div>
        <!-- First Page End -->
    </body>

</html>` ![images](images/9781430239031_Fig04-08.jpg)

**图 4–8。 *jQueryMobile 表单元素***

在第二个例子中，HTML select 被包装在一个好看的开/关开关中。请注意，当您以编程方式从中获取值时，您将把它用作 HTML 选择框。您还用滑块包装了一个文本框。滑块的值放在文本框中。这相当于用户在文本框中填写一个数字，但是使用 jQueryMobile，用户可以使用滑块在给定的范围内选择一个值。参见[Figure 4–9](#fig_4_9)来看看这个 HTML 是如何呈现的。

`<!DOCTYPE html>
<html>

    <head>
        <title>jQuery Mobile Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        <!-- Main Page-->
        <div data-role="page" id="main">
            <div data-role="header" data-position="inline">
                <a href="index.html" data-icon="delete">Cancel</a>
                <h1>
                    Edit Contact
                </h1>
                <a href="index.html" data-icon="check">Save</a>
            </div>
            <div data-role="content">
                <form action="#" method="get">
                    <h2>
                        Simple Form Elements
                    </h2>
                    <div data-role="fieldcontain">
                        <label for="onoff-slider">
                            On/Off Switch:
                        </label>
                        <select name="onoff-slider" id="onoff-slider" data-role="slider">
                            <option value="off">
                                Off
                            </option>
                            <option value="on">
                                On
                            </option>
                        </select>
                    </div>
                    <div data-role="fieldcontain">
                        <label for="range-slider">
                            Range Slider:
                        </label>
                        <input type="range" name="range-slider" id="range-slider" value="0" min="10"
                        max="100" />
                    </div>
                </form>
            </div>
            <div data-role="footer" class="ui-bar">
                <a href="index.html" data-role="button" data- icon="delete">Remove</a>
                <a href="index.html" data-role="button" data-icon="plus">Add</a>
                <a href="index.html" data-role="button" data-icon="arrow-
u">Up</a>
                <a href="index.html" data-role="button" data-icon="arrow-
d">Down</a>
            </div>
        </div>
        <!-- First Page End -->
    </body>

</html>` ![images](images/9781430239031_Fig04-09.jpg)

**图 4–9。 *jQueryMobile 表单元素*T3】**

在下面的例子中，你可以看到将 HTML 单选按钮和复选框包装成好看的小部件是多么容易。这是通过使用数据角色“控制组”和数据类型“水平”来完成的请参见[图 4–10](#fig_4_10)了解单选和多选表单元素的外观:

`<!DOCTYPE html>
<html>

    <head>
        <title>jQuery Mobile Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        <!-- Main Page-->
        <div data-role="page" id="main">
            <div data-role="header" data-position="inline">
                <a href="index.html" data-icon="delete">Cancel</a>
                <h1>
                    Edit Contact
                </h1>
                <a href="index.html" data-icon="check">Save</a>
            </div>
            <div data-role="content">
                <form action="#" method="get">
                    <h2>
                        Single and MultiSelect Form Elements
                    </h2>
                    <div data-role="fieldcontain">
                        <fieldset data-role="controlgroup">
                            <legend>
                                Choose a base:
                            </legend>
                            <input type="radio" name="radio-choice-1" id="radio-choice-1" value="choice-1"
                            checked="checked" />
                            <label for="radio-choice-1">
                                Thin Crust
                            </label>
                            <input type="radio" name="radio-choice-1" id="radio-choice-2" value="choice-2"
                            />
                            <label for="radio-choice-2">
                                Double Cheese Burst
                            </label>
                            <input type="radio" name="radio-choice-1" id="radio-choice-3" value="choice-3"
                            />
                            <label for="radio-choice-3">
                                Class Hand Tossed
                            </label>
                        </fieldset>
                    </div>
                    <div data-role="fieldcontain">
                        <fieldset data-role="controlgroup">
                            <legend>
                                Choose Pizza toppings
                            </legend>
                            <input type="checkbox" name="checkbox-
1a" id="checkbox-1a" class="custom" />
                            <label for="checkbox-
1a">
                                Jalepeno
                            </label>
                            <input type="checkbox" name="checkbox-
2a" id="checkbox-2a" class="custom" />
                            <label for="checkbox-2a">
                                Olives
                            </label>
                            <input type="checkbox" name="checkbox-
3a" id="checkbox-3a" class="custom" />
                            <label for="checkbox-3a">
                                Cheese
                            </label>
                            <input type="checkbox" name="checkbox-
4a" id="checkbox-4a" class="custom" />
                            <label for="checkbox-
4a">
                                Capsicum
                            </label>
                        </fieldset>
                    </div>
                    <div data-role="fieldcontain">
                        <fieldset data-role="controlgroup" data- type="horizontal">
                            <legend>
                                Non Veg topping:
                            </legend>
                            <input type="checkbox" name="checkbox-6" id="checkbox-6" class="custom"
                            />
                            <label for="checkbox-
6">
                                Pepperoni
                            </label>
                            <input type="checkbox" name="checkbox-7" id="checkbox-7" class="custom"
                            />
                            <label for="checkbox-7">
                                Ham
                            </label>
                            <input type="checkbox" name="checkbox-8" id="checkbox-8" class="custom"
                            />
                            <label for="checkbox-8">
                                Turkey
                            </label>
                        </fieldset>
                    </div>
                    <div data-role="fieldcontain">
                        <fieldset data-role="controlgroup" data- type="horizontal">
                            <legend>
                                Payment Type:
                            </legend>
                            <input type="radio" name="radio-choice-b" id="radio-choice-c" value="on"
                            checked="checked" />
                            <label for="radio-choice-c">
                                Cash
                            </label>
                            <input type="radio" name="radio-choice-b" id="radio-choice-d" value="off"
                            />
                            <label for="radio-choice-d">
                                Coupons
                            </label>
                            <input type="radio" name="radio-choice-b" id="radio-choice-e" value="other"
                            />
                            <label for="radio-choice-e">
                                Credit Card
                            </label>
                        </fieldset>
                    </div>
                </form>
            </div>
            <div data-role="footer" class="ui-bar">
                <a href="index.html" data-role="button" data- icon="delete">Remove</a>
                <a href="index.html" data-role="button" data-icon="plus">Add</a>
                <a href="index.html" data-role="button" data-icon="arrow-
u">Up</a>
                <a href="index.html" data-role="button" data-icon="arrow-
d">Down</a>
            </div>
        </div>
        <!-- First Page End -->
    </body>

</html>` ![images](images/9781430239031_Fig04-10.jpg)

**图 4–10。 *jQueryMobile 表单元素***

#### 列表视图

到目前为止，您已经看到了用带有数据角色和 CSS 类的简单 HTML 元素来声明各种 UI 小部件是多么容易。在 jQueryMobile 中，列表视图也不例外。下面的例子将向你展示如何将一个 HTML 列表转换成一个移动可滚动列表。

`<ul data-role="listview" data-theme="g">
    <li>
        <a href="usa.HTML">USA</a>
    </li>
    <li>
        <a href="uk.HTML">UK</a>
    </li>
    <li>
        <a href="russia.HTML">Russia</a>
    </li>
</ul>`

下面是如何在 HTML 中声明列表的完整代码示例。对于动态数据，您所要做的就是在运行时将 li 元素追加到 ul 元素中。请参考[Figure 4–11](#fig_4_11)查看 jQueryMobile 中的列表视图。

`<!DOCTYPE HTML>
<HTML>

    <head>
        <title>jQuery Mobile Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
    </head>

    <body>
        <!-- Main Page-->
        <div data-role="page" id="main">
            <div data-role="header">
                <h1>
                    Header
                </h1>
            </div>
            <div data-role="content">
                <ul data-role="listview" data-theme="c">
                    <li>
                        <a href="usa.HTML">USA</a>
                    </li>
                    <li>
                        <a href="uk.HTML">UK</a>
                    </li>
                    <li>
                        <a href="russia.HTML">Russia</a>
                    </li>
                </ul>
            </div>
            <div data-role="footer" class="ui-bar">
                <h1>
                    Footer
                </h1>
            </div>
        </div>
        <!-- First Page End -->
    </body>

</HTML>` ![images](images/9781430239031_Fig04-11.jpg)

**图 4–11。 *jQueryMobile 列表视图***

您可以在 jQueryMobile 网站上了解更多相关信息。点击此链接查看演示和文档:[http://jquerymobile.com/demos/1.0a4.1/](http://jquerymobile.com/demos/1.0a4.1/)。

### jQueryMobile 事件处理

在 jQueryMobile 中，事件处理可以分为两个方面:

1.  非 jQueryMobile 小部件生成的事件。例如文本框、文本区域、按钮、单选按钮等等。
2.  jQueryMobile 小部件和框架生成的事件。这些事件的例子是触摸事件、方向改变事件、滚动事件和页面生命周期事件。

#### 正常事件

普通事件应该像 jQuery 通常做的那样处理。在 jQuery 中，jQuery 选择器提供了一个通用方法 bind，它允许我们绑定到任何事件。

`<html>
    <head>…</head>

    <body>
        <button id=”mybutton”>mybutton</button>
    </body>
</html>

$("#mybutton").bind("click",function(event){
    alert("clicked mybutton");
});
jQuery also provides many convenience method for events like a short hand of above method is click method, which binds the callback to click event.

$("#mybutton").click(function(event){
    alert("clicked mybutton");
});`

您可以在以下网站上阅读有关 jQuery 事件的更多信息:

[http://api.jquery.com/category/events/](http://api.jquery.com/category/events/)

现在，转到 jQueryMobile 生成的事件。请注意，所有事件，无论其来源如何，都需要以上述方式处理。这同样适用于下面记录的事件。

下一节将讨论由 jQueryMobile 框架和小部件生成的各种事件。

#### 触摸事件

手机或平板电脑上的触摸事件与点击或双击等传统鼠标事件有很大不同。以类似的方式，在传统的鼠标事件中，手势是不可能的。jQueryMobile 提供了一组用于触摸手势的新事件。这些事件在[表 4–2](#tab_4_2)中描述。

![images](images/t0402.jpg)

以下是 jQueryMobile 如何处理触摸事件的示例。参见[图 4–12](#fig_4_12)中的示例。

`<!DOCTYPE html>
<html>

    <head>
        <title>jQuery Mobile Touch Events Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
        <script>
            $(document).ready(function() {
                $("#tap").bind("tap", function() {
                    alert("TapEvent");
                });
                $("#taphold").bind("taphold", function() {
                    alert("Tap Hold Event");
                });
                $("#swipe").bind("swipe", function() {
                    alert("Swipe Event");
                });
                $("#swipeleft").bind("swipeleft", function() {
                    alert("Swipe Left Event");
                });
                $("#swiperight").bind("swiperight", function() {
                    alert("Swipe Right Event");
                });
            });
        </script>
    </head>

    <body>
        <!--Main Page-->
        <div data-role="page" id="main">
            <div data-role="header">
                <h1>
                    Touch Events
                </h1>
            </div>
            <div data-role="content">
                <h1>
                    Touch Events example
                </h1>
                <p id="tap">
                    Tap here
                </p>
                <p id="taphold">
                    Tap and hold here
                </p>
                <p id="swipe">
                    Swipe in this area.
                </p>
                <p id="swipeleft">
                    Swipe Left &lt;-- in this area.
                </p>
                <p id="swiperight">
                    Swipe Right -- &gt; in this area.
                </p>
            </div>
            <div data-role="footer" class="ui-bar">
                <h1>
                    Footer
                </h1>
            </div>
        </div>
        <!-- First Page End -->
    </body>

</html>` ![images](images/9781430239031_Fig04-12.jpg)

**图 4–12。 *jQueryMobile 触摸事件。*T3】**

#### 方位变化事件

移动设备和平板设备都可以检测方位变化并做出反应。这非常有用，因为在纵向模式和横向模式下，移动设备或平板电脑的长宽比是不同的。jQueryMobile 允许开发人员使用这种方向更改来在两种模式下充分利用屏幕空间。为此，您需要侦听窗口元素上的“orientationchange”事件。下面的示例显示了这一点。参见[图 4–13](#fig_4_13)和[4–14](#fig_4_14)。

`<!DOCTYPE html>
<html>

    <head>
        <title>jQuery Mobile Touch Events Demo</title>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
            $(document).ready(function(){
                $(window).bind('orientationchange', function(event){
                    $("#placeholder").html("Orientation changed to "+event.orientation);
                });
            });
        </script>
    </head>

    <body>
        <!-- Main Page-->
        <div data-role="page" id="main">
            <div data-role="header">
                <h1>
                    Touch Events
                </h1>
            </div>
            <div data-role="content">
                <h1>
                    Orientation Events example
                </h1>
                <div id="placeholder">
                </div>
            </div>
            <div data-role="footer" class="ui-bar">
                <h1>
                    Footer
                </h1>
            </div>
        </div>
        <!-- First Page End -->
    </body>

</html>` ![images](images/9781430239031_Fig04-13.jpg)

**图 4–13。 *jQueryMobile 方向改变事件*T3】**

![images](images/9781430239031_Fig04-14.jpg)

**图 4–14。 *jQueryMobile 定向变更事件***

#### 滚动事件

移动设备的一个重要方面是滚动和滚动时在后台做事情的能力。想想惰性加载列表，它在用户滚动列表时获取数据。

为此，您需要滚动事件(参见[Table 4–3](#tab_4_3))。jQueryMobile 提供滚动事件。请注意，当 scrollstart 事件在 iOS 上不按预期工作时，我们建议不要依赖 iOS 上的 scrollstart 事件。

T2】

#### 页面事件

jQueryMobile 有页面的概念。jQueryMobile 中的页面被创建、显示和/或隐藏。jQueryMobile 提供了事件，这样开发人员可以在页面创建之前、创建之后以及页面显示和隐藏之前和之后进行适当的处理。所有这些事件都记录在[表 4–4](#tab_4_4)中。

![images](images/t0404.jpg)

### PhoneGap jQueryMobile 集成

既然您已经了解了 jQueryMobile 的工作原理，那么让我们来集成 PhoneGap 和 jQueryMobile 的特性来创建应用程序。

请注意，当您将 jQueryMobile 与 PhoneGap 一起使用时，有三个 JavaScript 框架，每个框架都有自己的引导。

1.  PhoneGap 框架
2.  jQuery 框架
3.  jQueryMobile 框架

虽然所有框架都提供了自己的引导机制，但最好按照以下顺序引导这些框架:

1.  语音间隙
2.  框架
3.  jQueryMobile(如果真的需要的话)。

这显示在以下示例中:

`<script>

    //onDeviceReady is called when PhoneGap is initialized

    function onDeviceReady() {
        $(document).ready(function() {
            //Call any jQuery functions here
        });
    }
    document.addEventListener(deviceready, onDeviceReady);
</script>`

### 使用 jQueryMobile 和 PhoneGap 进行本地搜索

让我们来测试一下 jQueryMobile 和 PhoneGap。您将构建 PhoneGap geo、compass 和数据库特性的混搭，并结合使用 jQueryMobile 构建的 UI 和 Google Maps Places API。参见[图 4–15](#fig_4_15)。

这种混搭被称为本地搜索。这个混搭具有以下特性:

1.  允许用户在他/她的当前位置的给定半径内搜索感兴趣的地方。
2.  允许用户查看该地点的详细信息并访问该地点的网站。
3.  允许用户将地点保存为收藏夹，并将其从收藏夹中删除。
4.  允许用户浏览他保存的收藏夹。
5.  允许用户在谷歌地图上查看所有的搜索结果。

![images](images/9781430239031_Fig04-15.jpg)

**图 4–15。*使用 jQueryMobile 和 PhoneGap 的本地搜索*T4】**

该屏幕中最重要的两个特征如下(参见[图 4–16](#fig_4_16)):

1.  搜索按钮用于搜索用户位置 5 公里半径内的比萨饼
2.  收藏夹按钮向用户显示所有标记为收藏夹的地方

![images](images/9781430239031_Fig04-16.jpg)

**图 4–16。*使用 jQueryMobile 和 PhoneGap 的本地搜索*T4】**

搜索结果可以在地图上显示为列表或标记。[Figure 4–17](#fig_4_17)显示了结果如何在中显示为列表。

![images](images/9781430239031_Fig04-17.jpg)

**图 4–17。*本地搜索结果***

当用户单击其中一个搜索结果时，他会被带到企业详细信息页面。该页面显示了详细信息，如名称、地址和电话号码，以及企业附近。它还允许用户将业务条目添加到他/她的收藏夹中，或者从收藏夹中删除它。这显示在[图 4–18](#fig_4_18)中。

![images](images/9781430239031_Fig04-18.jpg)

**图 4–18。*本地搜索业务明细***

当用户将企业添加到他的收藏夹时，他可以从主页导航到收藏夹页面。在这里，用户将看到保存为收藏夹的地点/企业。这些条目实际上存储在应用的内部数据库中(由 PhoneGap 提供)(参见[图 4–19](#fig_4_19))。

![images](images/9781430239031_Fig04-19.jpg)

**图 4–19。*本地存储的收藏夹。*T3】**

同样，当用户点击其中一个条目时，他会被带到详细信息页面。如果您能观察到，我们现在可以看到“移至收藏夹”按钮，因为该企业/地点已经是收藏夹的一部分。参见[图 4–20](#fig_4_20)。

![images](images/9781430239031_Fig04-20.jpg)

**图 4–20。*最喜欢的细节。*T3】**

最后，但并非最不重要的是，整个搜索结果绘制在谷歌地图上。为此，您需要进入主页，点击搜索，然后点击地图选项卡。您将看到如图[图 4–21](#fig_4_21)所示的屏幕。

![images](images/9781430239031_Fig04-21.jpg)

**图 4–21。*地图上的本地搜索结果***

#### 引导 PhoneGap 和 jQuery

引导按以下顺序完成:

1.  当调用 PhoneGap JavaScript 库时，PhoneGap 被引导来调用 onDeviceReady()函数
2.  在 onDeviceReady 中，jQuery 被引导，以便在加载 jQuery 时调用匿名函数

`<script>
function onDeviceReady(){
                $(document).ready(function(){
                        //Register event handlers
                });
}
document.addEventListener(deviceready,onDeviceReady);
</script>`

#### 安装必要的 JavaScript 库

对于这个项目，您将需要以下 JavaScript 库

1.  jQuery: `[http://docs.jquery.com/Downloading_jQuery#Download_jQuery](http://docs.jquery.com/downloading_jquery#download_jquery)`
2.  jQueryMobile: `[http://jquerymobile.com/download/](http://jquerymobile.com/download/)`
3.  jQuery ui 映射:t0]
4.  语音间隙:`[www.phonegap.com/download/](http://www.phonegap.com/download/)`

假设您的应用程序 JavaScript 名为 app.js，应用程序 CSS 名为 app.css，您的 www 文件夹应该如图[Figure 4–22](#fig_4_22)所示。注意，images 文件夹属于 jQueryMobile 库。

![images](images/9781430239031_Fig04-22.jpg)

**图 4–22。*本地搜索项目结构***

#### 本地搜索的布局

本地搜索页面是应用程序中的主页面。进行本地搜索需要三个输入。

1.  PhoneGap 的地理位置
2.  从搜索文本框中搜索关键字
3.  jQueryMobile 滑块的搜索半径

一旦完成，它将获取搜索结果并显示在搜索结果页面中。

`<!-- Main Search Page -->
<div data-role="page">
    <div data-role="header">
        <h1>
            Local Search
        </h1>
    </div>
    <!-- /header -->
    <div data-role="content">
        <div data-role="fieldcontain">
            <label for="search">
                Local Search
            </label>
            <input type="search" name="searchbox" id="searchbox" value="Pizza" />
        </div>
        <div data-role="fieldcontain">
            <label for="slider">
                Search Range(kms):
            </label>
            <input type="range" name="range" id="range" value="5" min="1" max="25"
            />
        </div>
        <div data-role="fieldcontain">
            <button name="search" id="search">
                Search
            </button>
        </div>
        <div data-role="controlgroup" data-type="horizontal">
            <a href="#fav" data-role="button" data-icon="home">Favorites</a>
            <a href="index.html" data-role="button" data-icon="info">About us</a>
        </div>
    </div>
    <!-- /content -->
</div>`

#### 寻找当地企业

为了搜索感兴趣的地方，我们使用谷歌地图的位置 API。可以通过对 Google Maps Places 服务端点进行 restful 调用来搜索感兴趣的地方。进行这个 restful 调用需要很多参数；这些显示在[表 4–5](#tab_4_5)中。

![images](images/t0405.jpg)

此处显示的 URL 带有每个参数的填充符:

`https://maps.googleapis.com/maps/api/place/search/json?location={<ins>latitude,longi
tude</ins>}&radius={<ins>radius</ins>}&types=food&name={<ins>search_keyword</ins>}
&sensor=false&key={<ins>api_key</ins>}.`

对于以下 URL，会出现 JSON 响应:

`https://maps.googleapis.com/maps/api/place/search/json?location=-
33.8670522,151.1957362&radius=500&types=food&name=harbour&sensor=true&key=<<api
key>>`.

JSON 的回应如下:

`{
    "html_attributions": ["Listings by \u003ca
href=\"http://www.yellowpages.com.au/\"\u003eYellow Pages\u003c/a\u003e"],
    "results": [{
        "geometry": {
            "location": {
                "lat": -33.8719640,
                "lng": 151.1985440
            }
        },
        "icon": "http://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png",
        "id": "aefbc59325ffd5f3e93d67932375d20d143289de",
        "name": "Toros Restaurant Darling Harbour",
        "reference":
"CoQBdgAAAE6oRybc13OZYNH0WeuwKzTfzjYXO8nuWyGqCqSTBogR_BZxE30fgXsybOl_wIR0s_uuHLZqq-
17DTgpGHZoSehSbOG73dfIxO3rpQak2OmNuBb5Kg63rPN_afbH_PnbILiofw6WSODYOCkqhFl38qSXyujAPkQKZU
76NJypgT6mEhCg1MhyNAuyark4X8YfRg4YGhTn_MXr0gelHUHPe3JMCic-cHlu3A",
        "types": ["restaurant", "food", "establishment"],
        "vicinity": "Darling Dr, Sydney"
    }, …]
}`

注意，在前面的 JSON 中，有一个 id 和引用。您需要更好地理解这些，以便能够构建您的应用程序。

Id 是一个地方的唯一标识符。当您在数据库中存储地点/企业时，您将使用 id 作为主键。但是，id 不能用于获取最新信息。

Reference 是一个键，用于从 Google Places 服务器获取一个地点/企业的详细信息。但是，请注意，引用在多个搜索结果中不是唯一的。

因此，您将在数据库中存储 id(作为主键)和 reference(作为字符串)，这样您就可以唯一地标识一个地点/企业(使用 id ),并随时使用 reference 从 Google Places 获取信息。

#### HTML 中的整体布局

下面是应用程序的总体布局。在应用程序的所有五个页面中:

1.  搜索页面
2.  id 为“列表”的搜索结果页面
3.  id 为“详细信息”的详细信息页面
4.  id 为“收藏”的收藏列表页面
5.  id 为“Map”的地图页面

`<!DOCTYPE HTML>
<html>

    <head>
        <title>PhoneGap</title>
        <link rel="stylesheet" type="text/css" href="app.css" />
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script type="text/javascript" src="jquery.ui.map.min.js"></script>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
        <script type="text/javascript" src="phonegap-1.1.0.js"></script>
        <script type="text/javascript" src="app.js"></script>
    </head>

    <body>
        <!-- Main Search Page -->
        <div data-role="page">
            <div data-role="header">
                <h1>
                    Local Search
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <div data-role="fieldcontain">
                    <label for="search">
                        Local Search
                    </label>
                    <input type="search" name="searchbox" id="searchbox" value="Pizza" />
                </div>
                <div data-role="fieldcontain">
                    <label for="slider">
                        Search Range(kms):
                    </label>
                    <input type="range" name="range" id="range" value="5" min="1" max="25"
                    />
                </div>
                <div data-role="fieldcontain">
                    <button name="search" id="search">
                        Search
                    </button>
                </div>
                <div data-role="controlgroup" data-type="horizontal">
                    <a href="#fav" data-role="button" data-icon="home">Favorites</a>
                    <a href="index.html" data-role="button" data-icon="info">About us</a>
                </div>
            </div>
            <!-- /content -->
        </div>
        <!-- /page -->
        <!-- Search Result List Page -->
        <div data-role="page" id="list">
            <div data-role="header" data-position="fixed">
                <h1>
                    Result
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <ul id="result-list" data-role="listview" data-theme="g">
                </ul>
            </div>
            <!-- /content -->
            <div data-role="footer" data-id="result-footer" data-position="fixed"
               class="ui-bar-a
                   ui-footer ui-footer-fixed fade ui-fixed-overlay"
               role="contentinfo" style="top: -1263px; ">
                <div data-role="navbar" class="ui-navbar ui-navbar-noicons" role="navigation">
                    <ul class="ui-grid-a">
                        <li class="ui-block-a">
                            <a href="#list" data-theme="a"
                                class="ui-btn-active ui-state-persist ui-btn ui-btn-up-a">
                                <span class="ui-btn-inner"><span class="ui-btn-text">List</span></span>
                            </a>
                        </li>
                        <li class="ui-block-b">
                            <a href="#map" data-theme="a"
                                class="ui-state-persist ui-btn ui-btn-up-a">
                                <span class="ui-btn-inner"><span class="ui-btn-text">Maps</span></span>
                            </a>
                        </li>
                    </ul>
                </div>
                <!-- /navbar -->
            </div>
            <!-- /footer -->
        </div>
        <!-- /page -->
        <!-- Maps Page -->
        <div data-role="page" id="map">
            <div data-role="header">
                <h1>
                    Map
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content" class="map-content">
                <div id="map_canvas">
                </div>
            </div>
            <!-- /content -->
            <div data-role="footer" data-id="result-footer"
                data-position="fixed"
                class="ui-bar-a ui-footer ui-footer-fixed fade ui-fixed-overlay"
                role="contentinfo" style="top: -1263px; ">
                <div data-role="navbar" class="ui-navbar ui-navbar-noicons" role="navigation">
                    <ul class="ui-grid-a">
                        <li class="ui-block-a">
                            <a href="#list" data-theme="a" class="ui-state-persist ui-btn ui-btn-up-a">
                                <span class="ui-btn-inner"><span class="ui-btn-text">List</span></span></a>
                        </li>
                        <li class="ui-block-b">
                            <a href="#map" data-theme="a"
                                class="ui-btn-active ui-state-persist ui-btn ui-btn-up-a">
                                <span class="ui-btn-inner"><span class="ui-btn-text">Maps</span></span></a>
                        </li>
                    </ul>
                </div>
                <!-- /navbar -->
            </div>
            <!-- /footer -->
        </div>
        <!-- /page -->
        <!--Favorite List Page -->
        <div data-role="page" id="fav">
            <div data-role="header">
                <h1>
                    Favorites
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <!--
                    <ul id="fav-list" data-role="listview" data-theme="g"></ul>
                -->
                <ul id="fav-list" data-role="listview" data-theme="g">
                </ul>
            </div>
            <!-- /content -->
            <div data-role="footer" data-id="result-footer" data-position="fixed"
                class="ui-bar-a ui-footer ui-footer-fixed fade ui-fixed-overlay"
                role="contentinfo" style="top: -1263px; ">
                <!-- /navbar -->
            </div>
            <!-- /footer -->
        </div>
        <!-- /page -->
        <!-- Business Details Page -->
        <div data-role="page" id="details">
            <div data-role="header">
                <h1>
                    Business Details
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <table summary="Business Details">
                    <caption>
                        <h3>
                            Business Details
                        </h3>
                    </caption>
                    <tfoot>
                        <tr>
                            <td colspan="2">
                                <div id="remove">
                                    <button id="removefav" data-role="button">
                                        Remove to Favorite
                                    </button>
                                </div>
                                <div id="add">
                                    <button id="addfav" data-role="button">
                                        Add to Favorite
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <a id="homepage" data-role="button" href="">Visit HomePage</a>
                            </td>
                        </tr>
                    </tfoot>
                    <tbody>
                        <tr>
                            <th scope="row">
                                Name
                            </th>
                            <td id="name">
                                …
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">
                                Address
                            </th>
                            <td id="address">
                                …
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">
                                Phone
                            </th>
                            <td id="phone">
                                …
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">
                                Rating
                            </th>
                            <td id="rating">
                                …
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- /content -->
        </div>
        <!-- /page -->
    </body>

</html>`

#### 获取并显示搜索结果

函数启动的搜索将搜索按钮事件与实际执行搜索的函数绑定在一起。

以下是搜索的事件流程:

1.  向用户显示加载图标，让他/她知道正在进行长时间操作。这是通过调用$ .mobile.showPageLoadingMsg()来实现的；。
2.  使用 PhoneGap 函数 navigator . geolocation . getcurrentposition(success callback，failureCallback)获取用户的当前位置。
3.  在上述调用的 successCallback 中，使用以下参数完成了对 Google Places 的 JSON 请求:
    1.  地理定位
    2.  搜索关键字
    3.  地理位置的搜索半径
    4.  Google Places 的开发者 Api 密钥
    5.  `var`
        T1】
4.  jQuery 的$。getJSON()用于对 Google Places 进行 Ajax 调用，以获取 JSON 响应。请注意，由于 PhoneGap 应用程序没有域名，因此您不会受到浏览器单一来源政策的限制。用$注册 successCallback 和 failureCallback。getJSON()函数。
5.  在上述调用的 successCallback 中，获取位置响应并将其附加到 id 为“result-list”的 ul 元素中。这个 ul 元素在 HTML 代码中被注释为 jQueryMobile 列表视图。一旦您将必要的 li 元素添加到 ul 元素中，我们将调用$(“结果列表”)。listView(“refresh”)将 ul 元素重绘为 jQueryMobile 列表。
6.  注意，您将每个地方的 JSON 响应的引用部分作为链接的 id(一个元素)。这样做是为了当用户点击这个条目时，他会被带到详细信息页面。注意，这个链接的 href 部分实际上是“#details”
7.  最后，您将一个 click 处理程序与 place 上的 click 事件绑定在一起，这样您就可以实际调用 Google Places 服务器，在将用户导航到详细信息页面之前获取企业/地点条目的详细信息。
8.  最后一步是通过调用$.mobile.hidePageLoadingMsg()移除加载图标；。

`/**
  * Binding Search button handler to go and fetch place results
  */
**function** initiateSearch(){
        $("#search").click(**function**(){
**try** {
                $.mobile.showPageLoadingMsg();

navigator.geolocation.getCurrentPosition(**function**(position){

**var** radius = $("#range").val() * 1000;
mapdata = **new** google.maps.LatLng(position.coords.latitude, position.coords.longitude);
**var** url = "https://maps.googleapis.com/maps/api/place/search/json?location=" +
position.coords.latitude + "," + position.coords.longitude + "&radius=" + radius +
"&name=" + $("#searchbox").val() + "&sensor=false&key=AIzaSyC4vCfT_Knq1SGuNMahZqyrmZFiTuBsdlY";
                    $.getJSON(url, **function**(data){
cachedData = data;
                        $("#result-list").html("");
**try** {
                            $(data.results).each(**function**(index, entry){

**var** htmlData = "<a href=\"#details\" id=\"" + entry.reference + "\"><img src=\"" +
entry.icon + "\" class=\"ui-li-icon\"></img><h3>&nbsp;" + entry.name +
"</h3><p><strong>&nbsp;vicinity:" + entry.vicinity + "</strong></p></a>";
**var** liElem = $(document.createElement('li'));

                                $("#result-list").append(liElem.html(htmlData));

                                $(liElem).bind("tap", **function**(event){
event.stopPropagation();
fetchDetails(entry);
**return** true;
                                });

                            });
                                                        $("#result-
list").listview('refresh');
                        }
**catch** (err) {
console.log("Got error while putting search result on result page " + err);
                        }

                        $.mobile.changePage("list");
                        $.mobile.hidePageLoadingMsg();
                    }).error(**function**(xhr, textStatus, errorThrown){
console.log("Got error while fetching search result : xhr.status=" + xhr.status);

                    }).complete(**function**(error){
                         $.mobile.hidePageLoadingMsg();
                    });
                }, **function**(error){
console.log("Got Error fetching geolocation " + error);
                });

            }
**catch** (err) {
console.log("Got error on clicking search button " + err);
            }

        });

    }`

#### 显示一个地方/商业的细节

您已经看到，当用户单击显示地点搜索结果列表中的地点条目时，会调用 fetchDetails()函数。

fetchDetails()函数的流程如下:

1.  向用户显示加载图标。这是通过调用$ .mobile.showPageLoadingMsg()来完成的。
2.  明细位的所有字段都被重置为空白。例如$(“# name”)。html()；。
3.  创建一个详细信息位置请求的 URL(details URL ),并使用 jQuery $进行 Ajax 调用。getJSON()调用。
4.  在$的成功回调中。getJSON()，您将获得页面的详细信息。在这里，您首先检查给定的地点是否已经被用户存储为收藏夹。基于此，向用户显示“添加到收藏夹”或“从收藏夹移除”按钮。
5.  此页面的字段已填充。
6.  加载图标通过调用$.mobile.hidePageLoadingMsg()来移除。

`/**
     * Fetch the details of a place/business. This function is called before user navigates to details page
     * **@param** {Object} reference
     */
**function** fetchDetails(entry){

currentBusinessData = null;

        $.mobile.showPageLoadingMsg();
**var** detailsUrl = "https://maps.googleapis.com/maps/api/place/details/json?reference=" +
entry.reference + "&sensor=true&key=<API_Key>";
        $("#name").html("");
        $("#address").html("");
        $("#phone").html("");
        $("#rating").html("");
        $("#homepage").attr("href", "");

        $.getJSON(detailsUrl, **function**(data){
**if** (data.result) {
currentBusinessData = data.result;

isFav(currentBusinessData, **function**(isPlaceFav){
                                        console.log(currentBusinessData.name+" is fav
"+isPlaceFav);
**if** (!isPlaceFav) {

                        $("#add").show();
                        $("#remove").hide();
                    }
**else** {

                        $("#add").hide();
                        $("#remove").show();
                    }
                    $("#name").html(data.result.name);
                    $("#address").html(data.result.formatted_address);
                    $("#phone").html(data.result.formatted_phone_number);
                    $("#rating").html(data.result.rating);
                    $("#homepage").attr("href", data.result.url);

                });
            }
        }).error(**function**(err){
console.log("Got Error while fetching details of Business " + err);
        }).complete(**function**(){
            $.mobile.hidePageLoadingMsg();
        });

    }`

#### 在收藏夹中添加和删除地点/企业

下一步是实际观察

1.  我们如何将一个地方添加到收藏夹列表中？
2.  我们如何从收藏夹列表中删除一个位置？
3.  我们如何找到一个给定的地方是我们的收藏夹列表的一部分？

这里需要注意的是，您使用 PhoneGap 的数据库 API 来存储、检索和删除位置。所有这些信息都使用 PhoneGap 的数据库 API 存储在应用程序的数据库中。您将把收藏夹存储在名为“favorite”的表中

initiateFavButton()将“添加到收藏夹”和“从收藏夹中删除”按钮的点击处理程序绑定到实际的处理程序。“添加到收藏夹”按钮位于 id 为“添加”的 div 中，“从收藏夹中移除”位于 id 为“移除”的 div 中您可以通过隐藏或显示这些 div 来控制按钮的可见性。您还可以相应地调用 addToFavorite()和 removeFromFavorite()方法来实际执行添加和删除操作。

`/**
 * Called to bind the "Add to Favorite" Button
 */

function initiateFavButton() {
    $("#removefav").click(function () {

        try {
            if (currentBusinessData != null) {
                removeFromFavorite(currentBusinessData);
                $("#add").show();
                $("#remove").hide();

            }
        } catch (err) {
            console.log("Got Error while removing " + currentBusinessData.name + " error " + err);
        }

    });
    $("#addfav").click(function () {
        try {
            if (currentBusinessData != null) {
                addToFavorite(currentBusinessData);
                $("#add").hide();
                $("#remove").show();
            }
        } catch (err) {
            console.log("Got Error while adding " + currentBusinessData.name + " error " + err);
        }

    });

}`

ensureTableExists()是所有其他数据库函数使用的公共函数。此函数确保您在对数据库执行任何插入、选择或删除操作之前，执行 SQL 脚本“如果不存在则创建表收藏夹(id 唯一、引用、名称、地址、电话、评级、图标、邻近)”。

`/**
 * Ensure we have the table before we use it
 * @param {Object} tx
 */

function ensureTableExists(tx) {
    tx.executeSql('CREATE TABLE IF NOT EXISTS Favorite (id unique, reference,
name,address,phone,rating,icon,vicinity)');
}`

addToFavorite()是一个函数，它实际上为 favorites 表中的给定位置执行数据库插入。请注意，您正在数据库表“favorite”中存储 id、reference、name、icon、formatted_address、formatted_phone_number、rating 和 neighborhood。

`    /**
     * Add current business data to favorite
     * @param {Object} data
     */

    function addToFavorite(data) {
        var db = window.openDatabase("Favorites", "1.0", "Favorites", 20000000);

        db.transaction(function (tx) {
            ensureTableExists(tx);
            var id = (data.id != null) ? ('"' + data.id + '"') : ('""');
            var reference = (data.reference != null) ? ('"' + data.reference + '"') : ('""');
            var name = (data.name != null) ? ('"' + data.name + '"') : ('""');
            var address = (data.formatted_address != null) ? ('"' + data.formatted_address + '"') : ('""');
            var phone = (data.formatted_phone_number != null) ? ('"' + data.formatted_phone_number + '"') : ('""');
            var rating = (data.rating != null) ? ('"' + data.rating + '"') : ('""');
            var icon = (data.icon != null) ? ('"' + data.icon + '"') : ('""');
            var vicinity = (data.vicinity != null) ? ('"' + data.vicinity + '"') : ('""');
            var insertStmt = 'INSERT INTO Favorite (id,reference,
name,address,phone,rating,icon,vicinity) VALUES (' + id + ',' + reference + ',' + name + ',' + address + ',' + phone + ',' + rating + ',' + icon + ',' + vicinity + ')';
            tx.executeSql(insertStmt);

        }, function (error) {
            console.log("Data insert failed " + error.code + "   " + error.message);
        }, function () {
            console.log("Data insert successful");
        });

    }`

removeFromFavorite()是从“Favorite”表中删除收藏夹的函数。它只需要 id 就可以这样做。

`/**
 * Remove current business data from favorite
 * @param {Object} data
 */

function removeFromFavorite(data) {
    try {
        var db = window.openDatabase("Favorites", "1.0", "Favorites", 20000000);

        db.transaction(function (tx) {
            ensureTableExists(tx);
            var deleteStmt = "DELETE FROM Favorite WHERE id = '" + data.id + "'";
            console.log(deleteStmt);
            tx.executeSql(deleteStmt);

        }, function (error) {
            console.log("Data Delete failed " + error.code + "   " + error.message);
        }, function () {
            console.log("Data Delete successful");
        });
    } catch (err) {
        console.log("Caught exception while deleting favorite " + data.name);
    }

}`

isFav()是查询表“favorite”的函数，以找出给定的地点/企业是否已经存在于表中，并因此被用户标记为 favorite。

`    /**
     *
     * @param {Object} reference
     * @return true if place is favorite else false
     */

    function isFav(data, callback) {
        var db = window.openDatabase("Favorites", "1.0", "Favorites", 200000);
        try {
            db.transaction(function (tx) {
                ensureTableExists(tx);
                var sql = "SELECT * FROM Favorite where id='" + data.id + "'";
                tx.executeSql(sql, [], function (tx, results) {

                    var result = (results != null && results.rows != null && results.rows.length > 0);

                    callback(result);
                }, function (tx, error) {

                    console.log("Got error in isFav error.code =" + error.code + " error.message = " + error.message);
                    callback(false);

                });
            });
        } catch (err) {
            console.log("Got error in isFav " + err);
            callback(false);
        }
}`

#### 载入你最喜欢的地方

到目前为止，您已经在收藏夹中添加和删除了一个位置。您还看到了如何检查一个地方是否被用户设置为他/她的最爱。现在，让我们看看检索用户所有最喜欢的地方的代码。

当用户点击主页上的“收藏夹”按钮时，就会调用这个代码。

这段代码与 isFav()非常相似，只不过在这里您将从“favorite”表中获取所有条目，获取结果集，并用“fav-list”id 填充 UL。

填充部分类似于显示搜索结果。

请注意，每次用户导航到“收藏夹位置”时，您都会从数据库表“收藏夹”中获取结果这是通过监听页面的“pagebeforeshow”事件来完成的。“pagebeforeshow”事件在向用户显示 jQueryMobile 页面之前触发。

`/**
 * Called each time before user navigates to Favorites
 */

function initiateFavorites() {
    $("#fav").live("pagebeforeshow", function () {

        var db = window.openDatabase("Favorites", "1.0", "Favorites", 200000);
        try {
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM Favorite', [], function (tx, results) {

                    $("#fav-list").html("");
                    if (results != null && results.rows != null) {
                        for (var index = 0; index < results.rows.length; index++) {
                            var entry = results.rows.item(index)

                            var htmlData = "<a href=\"#details\" id=\"" + entry.reference + "\"><img src=\"" + entry.icon + "\" class=\"ui-li-icon\"></img><h3>&nbsp;" + entry.name + "</h3><p><strong>&nbsp;vicinity:" + entry.vicinity + "</strong></p></a>";

                            var liElem = $(document.createElement('li'));

                            $("#fav-list").append(liElem.html(htmlData));

                            $(liElem).bind("tap", function (event) {
                                event.stopPropagation();
                                fetchDetails(entry);
                                return true;
                            });

                        }
                        $("#fav-list").listview('refresh');
                    }
                }, function (error) {
                    console.log("Got error fetching favorites " + error.code + " " + error.message);
                });
            });
        } catch (err) {
            console.log("Got error while reading favorites " + err);
        }

    });
}`

#### 在地图上显示搜索结果

这个练习的最后一部分是在谷歌地图上显示一个地方的搜索结果。这有助于用户更好地了解一个地方的位置。在 initiateSearch()函数中，当接收到搜索结果时，将结果缓存在一个名为“cachedData”的 JavaScript 变量中。在这种情况下，您实际上将使用相同的数据在地图上绘制标记。

请注意，每次用户导航到“收藏夹位置”时，您都要重新绘制地图并从 cachedData 中绘制标记这是通过监听页面的“pagebeforeshow”事件来完成的。

`  /**
   * Called to initiate Map page
   */

  function initiateMap() {
      $("#map").live("pagebeforecreate", function () {
          try {

              $('#map_canvas').gmap({
                  'center': mapdata,
                  'zoom': 12,
                  'callback': function (map) {
                      $(cachedData.results).each(function (index, entry) {
                          $('#map_canvas').gmap('addMarker', {
                              'position': new
                              google.maps.LatLng(entry.geometry.location.lat, entry.geometry.location.lng),
                              'animation': google.maps.Animation.DROP
                          }, function (map, marker) {
                              $('#map_canvas').gmap('addInfoWindow', {
                                  'position': marker.getPosition(),
                                  'content': entry.name
                              }, function (iw) {
                                  $(marker).click(function () {
                                      iw.open(map, marker);
                                      map.panTo(marker.getPosition());
                                  });
                              });
                          });

                      });
                  }

              });
              console.log("Map initialized");
          } catch (err) {
              console.log("Got error while initializing map " + err);
          }

      });`

#### 完整的源代码

index.html 的完整来源如下:

`<!DOCTYPE HTML>
<html>

    <head>
        <title>PhoneGap</title>
        <link rel="stylesheet" type="text/css" href="app.css" />
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script type="text/javascript" src="jquery.ui.map.min.js"></script>
        <link href="jquery.mobile-1.0rc2.min.css" rel="stylesheet" type="text/css"/>
        <script src="jquery-1.6.4.min.js"></script>
        <script src="jquery.mobile-1.0rc2.min.js"></script>
        <script type="text/javascript" src="phonegap-1.1.0.js"></script>
        <script type="text/javascript" src="app.js"></script>
    </head>

    <body>
        <!-- Main Search Page -->
        <div data-role="page">
            <div data-role="header">
                <h1>
                    Local Search
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <div data-role="fieldcontain">
                    <label for="search">
                        Local Search
                    </label>
                    <input type="search" name="searchbox" id="searchbox" value="Pizza" />
                </div>
                <div data-role="fieldcontain">
                    <label for="slider">
                        Search Range(kms):
                    </label>
                    <input type="range" name="range" id="range" value="5" min="1" max="25"
                    />
                </div>
                <div data-role="fieldcontain">
                    <button name="search" id="search">
                        Search
                    </button>
                </div>
                <div data-role="controlgroup" data-type="horizontal">
                    <a href="#fav" data-role="button" data-icon="home">Favorites</a>
                    <a href="index.html" data-role="button" data-icon="info">About us</a>
                </div>
            </div>
            <!-- /content -->
        </div>
        <!-- /page -->
        <!-- Search Result List Page -->
        <div data-role="page" id="list">
            <div data-role="header" data-position="fixed">
                <h1>
                    Result
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <ul id="result-list" data-role="listview" data-theme="g">
                </ul>
            </div>
            <!-- /content -->
            <div data-role="footer" data-id="result-footer" data-position="fixed"
            class="ui-bar-a
ui-footer ui-footer-fixed fade ui-fixed-overlay" role="contentinfo" style="top: -
1263px; ">
                <div data-role="navbar" class="ui-navbar ui-navbar-noicons" role="navigation">
                    <ul class="ui-grid-a">
                        <li class="ui-block-a">
                            <a href="#list" data-theme="a" class="ui-btn-active ui-
state-persist ui-btn ui-btn-up-
a"><span class="ui-btn-inner"><span class="ui-btn-text">List</span></span></a>
                        </li>
                        <li class="ui-block-b">
                            <a href="#map" data-theme="a" class="ui-state-persist ui-btn
ui-btn-up-a"><span
class="ui-btn-inner"><span class="ui-btn-text">Maps</span></span></a>
                        </li>
                    </ul>
                </div>
                <!-- /navbar -->
            </div>
            <!-- /footer -->
        </div>
        <!-- /page -->
        <!-- Maps Page -->
        <div data-role="page" id="map">
            <div data-role="header">
                <h1>
                    Map
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content" class="map-content">
                <div id="map_canvas">
                </div>
            </div>
            <!-- /content -->
            <div data-role="footer" data-id="result-footer" data-position="fixed"
            class="ui-bar-a
ui-footer ui-footer-fixed fade ui-fixed-overlay" role="contentinfo" style="top: -
1263px; ">
                <div data-role="navbar" class="ui-navbar ui-navbar-noicons"
role="navigation">
                    <ul class="ui-grid-a">
                        <li class="ui-block-a">
                            <a href="#list" data-theme="a" class="ui-state-persist ui-
btn ui-btn-up-a"><span
class="ui-btn-inner"><span class="ui-btn-text">List</span></span></a>
                        </li>
                        <li class="ui-block-b">
                            <a href="#map" data-theme="a" class="ui-btn-active ui-state-
persist ui-btn ui-btn-up-
a"><span class="ui-btn-inner"><span class="ui-btn-text">Maps</span></span></a>
                        </li>
                    </ul>
                </div>
                <!-- /navbar -->
            </div>
            <!-- /footer -->
        </div>
        <!-- /page -->
        <!-- Favorite List Page -->
        <div data-role="page" id="fav">
            <div data-role="header">
                <h1>
                    Favorites
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <!-- <ul id="fav-list" data-role="listview" data-theme="g">
</ul>
                -->
                <ul id="fav-list" data-role="listview" data-theme="g">
                </ul>
            </div>
            <!-- /content -->
            <div data-role="footer" data-id="result-footer" data-position="fixed"
            class="ui-bar-a
ui-footer ui-footer-fixed fade ui-fixed-overlay" role="contentinfo" style="top: -
1263px; ">
                <!-- /navbar -->
            </div>
            <!-- /footer -->
        </div>
        <!-- /page -->
        <!-- Business Details Page -->
        <div data-role="page" id="details">
            <div data-role="header">
                <h1>
                    Business Details
                </h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <table summary="Business Details">
                    <caption>
                        <h3>
                            Business Details
                        </h3>
                    </caption>
                    <tfoot>
                        <tr>
                            <td colspan="2">
                                <div id="remove">
                                    <button id="removefav" data-role="button">
                                        Remove to Favorite
                                    </button>
                                </div>
                                <div id="add">
                                    <button id="addfav" data-role="button">
                                        Add to Favorite
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <a id="homepage" data-role="button" href="">Visit
HomePage</a>
                            </td>
                        </tr>
                    </tfoot>
                    <tbody>
                        <tr>
                            <th scope="row">
                                Name
                            </th>
                            <td id="name">
                                …
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">
                                Address
                            </th>
                            <td id="address">
                                …
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">
                                Phone
                            </th>
                            <td id="phone">
                                …
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">
                                Rating
                            </th>
                            <td id="rating">
                                …
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- /content -->
        </div>
        <!-- /page -->
    </body>

</html>`

app.js 的完整源代码如下。请注意，您需要用自己的钥匙替换<api_key>。可以从`[http://code.google.com/apis/maps/documentation/places](http://code.google.com/apis/maps/documentation/places)`获取 API 密钥。</api_key>

`var mapdata = null;

var cachedData = null;

var currentBusinessData = null;

/**
     * Fetch the details of a place/business. This function is called before user
navigates to details page
     * @param {Object} reference
     */

function fetchDetails(entry) {

    currentBusinessData = null;

    $.mobile.showPageLoadingMsg();
    var detailsUrl =
"https://maps.googleapis.com/maps/api/place/details/json?reference=" + entry.reference + "&sensor=true&key=<API_Key>";
    $("#name").html("");
    $("#address").html("");
    $("#phone").html("");
    $("#rating").html("");
    $("#homepage").attr("href", "");

    $.getJSON(detailsUrl, function (data) {
        if (data.result) {
            currentBusinessData = data.result;

            isFav(currentBusinessData, function (isPlaceFav) {
                console.log(currentBusinessData.name + " is fav
" + isPlaceFav);
                if (!isPlaceFav) {

                    $("#add").show();
                    $("#remove").hide();
                } else {

                    $("#add").hide();
                    $("#remove").show();
                }
                $("#name").html(data.result.name);
                $("#address").html(data.result.formatted_address);
                $("#phone").html(data.result.formatted_phone_number);
                $("#rating").html(data.result.rating);
                $("#homepage").attr("href", data.result.url);

            });
        }
    }).error(function (err) {
        console.log("Got Error while fetching details of Business " + err);
    }).complete(function () {
        $.mobile.hidePageLoadingMsg();
    });

}

//-------------------------------
/**
 * Called to initiate Map page
 */
function initiateMap() {
    $("#map").live("pagebeforecreate", function () {
        try {

            $('#map_canvas').gmap({
                'center': mapdata,
                'zoom': 12,
                'callback': function (map) {
                    $(cachedData.results).each(function (index, entry) {
                        $('#map_canvas').gmap('addMarker', {
                            'position': new
google.maps.LatLng(entry.geometry.location.lat, entry.geometry.location.lng),
                            'animation': google.maps.Animation.DROP
                        }, function (map, marker) {
                            $('#map_canvas').gmap('addInfoWindow', {
                                'position': marker.getPosition(),
                                'content': entry.name
                            }, function (iw) {
                                $(marker).click(function () {

                                    iw.open(map, marker);

                                    map.panTo(marker.getPosition());
                                });
                            });
                        });

                    });
                }

            });
            console.log("Map initialized");
        } catch (err) {
            console.log("Got error while initializing map " + err);
        }

    });

}
//--------------------------------------------------------------------------------
/**
 * Called to bind the "Add to Favorite" Button
 */

function initiateFavButton() {
    $("#removefav").click(function () {

        try {
            if (currentBusinessData != null) {
                removeFromFavorite(currentBusinessData);
                $("#add").show();
                $("#remove").hide();
            }
        } catch (err) {
            console.log("Got Error while removing " + currentBusinessData.name + " error
" + err);
        }

    });
    $("#addfav").click(function () {
        try {
            if (currentBusinessData != null) {

                addToFavorite(currentBusinessData);
                $("#add").hide();
                $("#remove").show();
            }
        } catch (err) {
            console.log("Got Error while adding " + currentBusinessData.name + " error "
+ err);
        }

    });

}
//--------------------------------------------------------------------------------------
-----------------
/**
 * Called each time before user navigates to Favorites
 */

function initiateFavorites() {
    $("#fav").live("pagebeforeshow", function () {

        var db = window.openDatabase("Favorites", "1.0", "Favorites", 200000);
        try {
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM Favorite', [], function (tx, results) {

                    $("#fav-list").html("");
                    if (results != null && results.rows != null) {
                        for (var index = 0; index < results.rows.length;
                        index++) {

                            var entry = results.rows.item(index)

                            var htmlData = "<a href=\"#details\" id=\"" +
entry.reference + "\"><img src=\"" + entry.icon + "\" class=\"ui-li-
icon\"></img><h3>&nbsp;" + entry.name +"</h3><p><strong>&nbsp;vicinity:" +
entry.vicinity + "</strong></p></a>";

                            var liElem = $(document.createElement('li'));

                            $("#fav-
list").append(liElem.html(htmlData));
                            $(liElem).bind("tap", function (event) {
                                event.stopPropagation();
                                fetchDetails(entry);
                                return true;
                            });

                        }
                        $("#fav-
list").listview('refresh');
                    }
                }, function (error) {
                    console.log("Got error fetching Favorites " + error.code + " " +
error.message);
                });
            });
        } catch (err) {
            console.log("Got error while reading Favorites " + err);
        }

    });
}
//--------------------------------------------------------------------------------
/**
 * Ensure we have the table before we use it
 * @param {Object} tx
 */

function ensureTableExists(tx) {
    tx.executeSql('CREATE TABLE IF NOT EXISTS Favorite (id unique,
reference, name,address,phone,rating,icon,vicinity)');
}
//-----------------------------------------------------------------------
/**
 * Add current business data to Favorite
 * @param {Object} data
 */

function addToFavorite(data) {
    var db = window.openDatabase("Favorites", "1.0", "Favorites", 20000000);

    db.transaction(function (tx) {
        ensureTableExists(tx);
        var id = (data.id != null) ? ('"' + data.id + '"') : ('""');
        var reference = (data.reference != null) ? ('"' + data.reference + '"') :
('""');
        var name = (data.name != null) ? ('"' + data.name + '"') : ('""');
        var address = (data.formatted_address != null) ? ('"' + data.formatted_address +
'"') : ('""');
        var phone = (data.formatted_phone_number != null) ? ('"' +
data.formatted_phone_number + '"') : ('""');
        var rating = (data.rating != null) ? ('"' + data.rating + '"') : ('""');
        var icon = (data.icon != null) ? ('"' + data.icon + '"') : ('""');
        var vicinity = (data.vicinity != null) ? ('"' + data.vicinity + '"') : ('""');
        var insertStmt = 'INSERT INTO Favorite (id,reference,
name,address,phone,rating,icon,vicinity) VALUES (' + id + ',' + reference + ',' + name +
',' + address + ',' + phone + ',' + rating + ',' + icon + ',' + vicinity + ')';
        tx.executeSql(insertStmt);
    }, function (error) {
        console.log("Data insert failed " + error.code + "   " + error.message);
    }, function () {
        console.log("Data insert successful");
    });

}
//----------------------------------------------------------------------------------
/**
 * Remove current business data from Favorite
 * @param {Object} data
 */

function removeFromFavorite(data) {
    try {
        var db = window.openDatabase("Favorites", "1.0", "Favorites", 20000000);

        db.transaction(function (tx) {
            ensureTableExists(tx);
            var deleteStmt = "DELETE FROM Favorite WHERE id
= '" + data.id + "'";
            console.log(deleteStmt);
            tx.executeSql(deleteStmt);

        }, function (error) {
            console.log("Data Delete failed " + error.code + "   " + error.message);
        }, function () {
            console.log("Data Delete successful");
        });
    } catch (err) {
        console.log("Caught exception while deleting Favorite " + data.name);
    }

}

//--------------------------------------------------------------------
/**
 *
 * @param {Object} reference
 * @return true if place is Favorite else false
 */

function isFav(data, callback) {
    var db = window.openDatabase("Favorites", "1.0", "Favorites", 200000);
    try {
        db.transaction(function (tx) {
            ensureTableExists(tx);
            var sql = "SELECT * FROM Favorite where id='" + data.id + "'";
            tx.executeSql(sql, [], function (tx, results) {

                var result = (results != null && results.rows != null &&
results.rows.length > 0);

                callback(result);
            }, function (tx, error) {
                console.log("Got error in isFav error.code =" + error.code + "
error.message = " + error.message);
                callback(false);

            });
        });
    } catch (err) {
        console.log("Got error in isFav " + err);
        callback(false);
    }

}

//-------------------------------------------------------------------------------
/**
 * Binding Search button handler to go and fetch place results
 */

function initiateSearch() {
    $("#search").click(function () {
        try {
            $.mobile.showPageLoadingMsg();

            navigator.geolocation.getCurrentPosition(function (position) {

                var radius = $("#range").val() * 1000;
                mapdata = new
                google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                var url =
"https://maps.googleapis.com/maps/api/place/search/json?location=" +
position.coords.latitude + "," + position.coords.longitude + "&radius=" + radius +
"&name=" + $("#searchbox").val() + "&sensor=true&key=<API_Key>";
                $.getJSON(url, function (data) {
                    cachedData = data;
                    $("#result-
list").html("");
                    try {

                        $(data.results).each(function (index, entry) {

                            var htmlData = "<a href=\"#details\" id=\"" +
entry.reference + "\"><img
src=\"" + entry.icon + "\" class=\"ui-li-icon\"></img><h3>&nbsp;" + entry.name +
"</h3><p><strong>&nbsp;vicinity:" + entry.vicinity + "</strong></p></a>";

                            var liElem = $(document.createElement('li'));

                            $("#result-list").append(liElem.html(htmlData));

                            $(liElem).bind("tap", function (event) {

                                event.stopPropagation();
                                fetchDetails(entry);

                                return true;
                            });
                        });

                        $("#result-list").listview('refresh');
                    } catch (err) {

                        console.log("Got error while putting search result on result
page " + err);
                    }
                    $.mobile.changePage("list");
                    $.mobile.hidePageLoadingMsg();
                }).error(function (xhr, textStatus, errorThrown) {
                    console.log("Got error while fetching search result : xhr.status=" +
xhr.status);

                }).complete(function (error) {
                    $.mobile.hidePageLoadingMsg();
                });
            }, function (error) {
                console.log("Got Error fetching geolocation " + error);
            });

        } catch (err) {
            console.log("Got error on clicking search button " + err);
        }
    });

}

//--------------------------------------------------------------

function bind() {
    initiateMap();
    initiateFavorites();
    initiateSearch();
    initiateFavButton();
}
//---------------------------------------------------

function onDeviceReady() {
    $(document).ready(function () {
        bind();
    });
}
document.addEventListener("deviceready", onDeviceReady);
//-------------------------

The complete source of the app.css is as follows

#map, .map-content, #map_canvas **{**
    width**:** 100%**;**
    height**:** 100%**;**
    padding**:** 0**;**
**}**

#map_canvas **{**
    height**:** min-height**:** 100%**;**
**}**`

#### jQueryMobile 的优点

jQueryMobile 是一个面向移动应用程序开发人员的易于使用的 JavaScript UI 框架。jQueryMobile 最好的部分是它的声明式 UI 编程。使用 HTML 标签来创建 UI，并添加“数据角色”页面来将 HTML 标签注释为页面、页眉、页脚、内容、列表和按钮，这使得快速编程 UI 布局变得非常容易。

jQueryMobile 的另一个优点是页面的概念。页面在 HTML 页面中被声明为 div。此外，jQueryMobile 内置了导航部分和历史管理部分。这消除了添加历史管理部分的麻烦。

虽然 jQueryMobile 为小部件和工具栏提供了很好的支持，但是这些的编程方面需要开发人员进行 DOM 操作。

jQueryMobile 最大的优势在于它建立在健壮的 jQuery 核心框架之上。jQueryMobile 的另一个优势是它支持 iOS、Android、BlackBerry、HP WebOS、诺基亚/Symbian、Windows Mobile、Opera Mobile/Mini、Firefox mobile 以及所有现代桌面浏览器。

jQueryMobile 为移动和平板应用程序提供了触摸事件。jQueryMobile 也提供了很好的主题支持。在主题之间切换就像改变 HTML 标签的属性一样简单。

#### jQueryMobile 的缺点

jQueryMobile 是一个非常好的轻量级框架，使用 jQuery 来操作 DOM 允许用户以一种简单的方式构建应用程序。然而，随着应用程序复杂性的增加，以及对数据模型和相应视图的需求，用 jQueryMobile 编程更多的是用 JavaScript 实现自己的 MVC 框架。

简而言之，当您的应用程序很复杂时，jQueryMobile 很难使用。缺乏 MVC 框架甚至模型和 JavaScript 视图，使得 jQueryMobile 中的 JavaScript UI 编程与 Sencha Touch 等其他框架相比非常痛苦。

#### 结论

如果移动应用程序相当简单，jQueryMobile 是一个很好的 JavaScript 移动 UI 开发框架。随着您的移动应用程序 UI 的复杂性增加，用 jQueryMobile 编程将变得更加繁琐。