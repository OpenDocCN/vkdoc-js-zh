© Graeme Stuart 2017 Graeme StuartIntroducing JavaScript Game Development [https://doi.org/10.1007/978-1-4842-3252-1_3](03.html)

# 3.根据设计绘图

Graeme Stuart<sup class="calibre7">1 </sup> (1)Market Harborough, Leicestershire, UK   In Chapter [2](02.html) we scribbled on the canvas and made a bit of a mess. This time we’ll try to render a familiar design. The skills we will look at in this chapter are developments of what you’ve learned in previous chapters, though in this chapter we’ll be demonstrating clearer intent with what we do. If this chapter has a message, it’s this: practice and become confident at each step, slowly adding complexity all the while. The things we’ve learned so far are pretty simple but are fundamental skills nonetheless. Repeating and adding a little bit more complexity is a useful way to practice and elaborate on what we have learned. Let’s start the whole process from scratch but bring forward our library code from the previous chapter. Try to follow these instructions without checking forwards to the code example until you need to:

1.  1.创建一个名为“练习 3”的新文件夹，并将第 [2](02.html) 章中的 drawing.js 文件复制到新文件夹中。
2.  2.创建一个名为 exercise3.html 的新文件，并设置一个标准的 HTML 模板。
3.  3.在元素中添加对 drawing.js 库的引用。
4.  4.在元素中，添加一个

    <canvas>元素来显示我们的场景。</canvas>

5.  5.添加一个带有必要 JavaScript 代码的

## 派克曼

We should all be familiar with the 1980 Namco classic game Pac-Man. The eponymous hero is pretty simple to draw—a filled yellow circle with a wedge cut out. We can draw him by drawing an arc, drawing a line to the center of the arc, and filling the path so it automatically closes the path. The only tricky part is choosing the start and end angles. Imagine an arrow starting in the center of a circle, pointing to the right. This is the zero angle (zero radians). Increasing the angle moves our arrow in a clockwise direction. An angle of π radians is half a circle, pointing to the left. An angle of 2π radians is a full turn and our arrow points to the right again. This is shown in Figure [3-1](#Fig1).![A455241_1_En_3_Fig1_HTML.jpg](Images/A455241_1_En_3_Fig1_HTML.jpg) Figure 3-1There are 2π radians (clockwise) in a circle To make our Pac-Man face right, we need to start the arc some number of radians past 0 (zero) and finish the arc the same angle before 2π. The total, open-mouth angle is perhaps a little less than a quarter turn (less than 0.5π radians), so let’s go for starting at 0.2π radians (pointing slightly down to the right) and ending at 1.8π radians (pointing slightly up to the right). Update your code as shown in Listing [3-1](#Par13). <!doctype html> <html>   <head>     <title>Pacmania</title>     <link rel="stylesheet" href="styles.css">     <script src="drawing.js"></script>   </head>   <body>     <h1>Pac-man</h1>     <canvas id="pacmania" width="400" height="400"></canvas>     <script>       var context = document.getElementById("pacmania").getContext("2d");       draw_grid(context);       context.beginPath();       context.arc(200, 200, 150, 0.2 * Math.PI, 1.8 * Math.PI);       context.lineTo(200, 200);       context.fillStyle = "yellow";       context.fill();     </script>   </body> </html> Listing 3-1A Simple Pac-Man This code should be familiar except for a few new lines. We’re using the context.arc method to draw an arc with a radius of 150 pixels, centered at point (200, 200), beginning at 0.2π radians, all the way around in a clockwise direction to 1.8π radians. To cut the wedge out, we draw a line to the center. We then set the fill style to yellow and fill the path—the result is shown in Figure [3-2](#Fig2). The context.arc method can optionally take a final Boolean parameter for drawing counterclockwise. This can be convenient when using arcs in more complicated paths.![A455241_1_En_3_Fig2_HTML.jpg](Images/A455241_1_En_3_Fig2_HTML.jpg) Figure 3-2Pac-Man is just a circle with a wedge cut out

## 创建一个函数

But Pac-Man eats pellets, and to do that he opens and closes his mouth as he moves along, so we need to be able to draw him with different-sized wedges cut out. Refactor your code into a function that draws Pac-Man and move your draw_pacman function into the drawing.js library. Your function will need to take four arguments. The first two arguments are the x- and y-coordinates. The third argument is the radius. The fourth argument is a value between 0 and 1 representing how “open” the mouth is from fully closed (0) to fully open (1). Also, so that your Pac-Man can be drawn onto lighter backgrounds, call context.closePath and context.stroke within your function to draw a black outline around your Pac-Man. This is a chance to create your own function.

## 随机选择

Calling the random method of the Math object (that is, calling Math.random()) generates a randomized number between 0 and 1\. Once you have your function, replace the old Pac-Man drawing code with a single line to draw a randomized Pac-Man via your function, like so: draw_pacman(context, 200, 200, 150, Math.random()); Refresh the page a few times to see the randomized mouth angle. We’re using Math. random to generate a random number between 0 and 1\. When we defined our function, we specified that the mouth angle could be passed in as an argument in this range. So, as long as the function draws the Pac-Man correctly, we should be drawing a Pac-Man with a randomized mouth angle. In another implementation, we could have the random number be multiplied by 0.2π to create the angle on either side of zero (0) that would be used for drawing the mouth. Each time the browser is reloaded, then, a new random number would be generated, and the drawing function would be called with a new mouth angle. Take your time and make sure you understand what you’re doing before continuing. This stuff is easy once you get the hang of it. Now we have a function, and we can use it to draw Pac-Mans all over our canvas. Try a simple loop to draw some random stuff. Here we’re using a do while loop to draw random Pac-Mans until a random number is generated that’s greater than 0.9\. The do while loop always executes at least once, so we should always see at least one Pac-Man drawn. When the random number is greater than 0.9, the loop ends. See Listing [3-2](#Par24). var min_radius = 5; var max_radius = 50; do {   let x = context.canvas.width * Math.random();   let y = context.canvas.height * Math.random();   let radius = min_radius + (max_radius - min_radius) * Math.random();   draw_pacman(context, x, y, radius, Math.random()); } while(Math.random() < 0.9); Listing 3-2Randomizing in a Loop It is clear that we have randomized the coordinates and the radius as well as the mouth angle. Notice that for readability we’ve defined a number of variables (min_radius, max_radius, x, y, and radius). These statements could have been passed directly into the function as arguments, as we’ve done for the mouth argument. Splitting the code up into simple statements improves clarity and allows the code to fit on the screen. Figure [3-3](#Fig3) shows what you should see. The resultant canvas is Pac-mania. Notice how the black outline we added to the drawing helps us to distinguish overlapping Pac-Mans .![A455241_1_En_3_Fig3_HTML.jpg](Images/A455241_1_En_3_Fig3_HTML.jpg) Figure 3-3Multiple, random Pac-Mans

## 摘要

In this chapter we reviewed paths and functions with a simple but familiar example. Notice how we ended up with a small piece of code in our script but that it does some fairly complex drawing thanks to our use of functions to abstract away the details of the actual individual drawing tasks. I also introduced randomization and loops—important concepts we’ll make use of extensively later on. Try experimenting with what we’ve done. Pick another familiar shape to draw. Create a function and decide what arguments should be made available. Randomize the inputs in a loop to create your own complex scene.