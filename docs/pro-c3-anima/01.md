# 一、CSS3 基础知识

近二十年来，级联样式表(CSS)标准一直被用来控制网页的显示。HTML 定义了*是什么:*标题、段落、地址、图片等等。CSS 描述了元素是如何呈现给用户的，包括颜色、边框和尺寸。CSS 包括很少有网页设计者考虑的表示控件，例如文本到语音转换服务对网页内容的发音方式。

CSS 的所有原始表示规则都是为静态内容设计的；即不随时间变化的 HTML 元素。直到最近，如果你想让一张图片在网页上淡入，只有几种网络技术可以使用，其中最流行的是 JavaScript 和 Flash 。然而，这些技术并不是完整的解决方案；它们有几个严重的缺点，我将在本章末尾讨论。

现在，我们有了 CSS3 变换、过渡和动画模块。这些是所有现代浏览器都支持的 CSS 语法的扩展，重叠，在某些情况下，取代了 JavaScript 和 Flash 的传统角色。虽然 CSS3 也有其局限性，但它是许多动态网页内容的发展方向。

要了解我们是如何走到这一步的，你需要知道我们去过哪里。这一介绍性章节将提供 CSS 开发过程的概述，以及 web 开发的现状，展望未来。

CSS 的开发

web 技术的独立发展有一段不稳定的历史:浏览器供应商有时推动技术向前发展，而其他技术实现通过采用不兼容的方法使 web 开发变得复杂。

万维网联盟(W3C) 的成立是为了尝试将 web 技术综合并标准化为一系列规范，这些规范得到了 Web 开发行业的广泛支持。W3C 可以被称为 web 开发的联合国:作为一个独立的标准机构，它可以评估不同的提议；为工业界、学术界、开发者和其他利益相关者之间的讨论创建论坛；谈判和解决分歧；并敲定每个人都同意遵循的最终规范。

CSS 标准是由 CSS 工作组(CSSWG) 开发的，它是 W3C 的一个子组。随着时间的推移，CSSWG 扩展了 CSS，对网页内容的更多方面提供了更好的控制。随着 CSS 2.1 接近它的最终完成状态，规范的进一步开发被分成多个模块。这些模块中的许多都是从“第三级”建议开始的，这导致开发人员使用无所不包的术语 *CSS3* 来描述 CSS2.1 之后的任何东西。从技术上来说，我在本书中关注的 web 技术——动画、变换和过渡——都是全新的第一级规范，因为它们在 CSS1 或 CSS2 中没有先例。在非常正式的讨论之外，web 开发行业将它们统称为 *CSS3* ，我将在本书中继续这样称呼。

与此同时，浏览器开发者继续创新。我将在本书中讨论的许多 CSS 属性最初是由 Apple、Google 和 Mozilla 提出的，而不是 W3C 或 CSS 工作组。这导致了一个问题:开发人员希望他们的浏览器支持这些很酷的技术*今天，*而不必等待 W3C 推荐、讨论和最终批准的漫长过程。每个人都知道 90 年代浏览器战争的惨痛教训以及相关的技术冲突。浏览器如何支持他们公司提出的最新技术，同时明确这些新特性是实验性的，并且不与 W3C 随后可能出现的官方声明相冲突？

这个解决方案被证明是可行的，但是有争议:CSS 厂商前缀。

CSS 厂商前缀

为了允许浏览器开发人员对 CSS3 进行创新，web 开发社区同意每个浏览器都有自己独特的前缀，用于提议的或实验性的 CSS 属性(参见表 1-1 )。

表 1-1。独特的浏览器前缀

| 前缀 | 浏览器 |
| --- | --- |
| `-moz--o-` | 浏览器 |
| `-webkit--ms-` | Safari/Chrome/KonquerorInternet Explorer 9+ |

![image](img/sq.jpg) **注意**此处显示的供应商前缀并不是唯一存在的，只是您在大多数情况下需要的前缀。供应商前缀的完整列表可在`http://alrra.github.com/little-helpers/vendor-prefixes/)`找到。

每个打算支持实验性 CSS 属性的浏览器都可以通过在其前面放置自己的供应商前缀来实现。请注意，这些属性在获得 W3C 的最终批准之前是不标准的。在那之前，它们对供应商和 W3C 本身的修改和解释都是开放的。由于考虑了不同的方法并制定了不同的标准，即使在同一个浏览器中，属性名及其值的指定方式也可能会快速变化。例如，直到 Safari 5.1/iOS 5.0 发布之前，Webkit 开发团队提出了以下在 CSS 中实现线性渐变的方法:

```html
body { background-image: -webkit-gradient(
linear,
left bottom,
left top,
color-stop(0.11, rgb(167,9,246)),
color-stop(0.56, rgb(194,242,242)) );
```

其他浏览器以不同的方式实现渐变。例如，在 Firefox 中是这样做的:

```html
body {
background-image: -moz-linear-gradient(bottom, rgb(167,9,246) 11%, rgb(194,242,242) 56%);
}
```

这两种方法在每个浏览器中产生相同的结果；争论的焦点是哪种编码方式更好。在渐变的情况下，W3C 采取了第三种方式，与 Firefox 的方法更接近:

```html
body {
background-image: linear-gradient(to bottom, rgb(167,9,246) 11%, rgb(194,242,242) 56%);
}
```

然而*，*因为浏览器不能被强制追溯升级，所以仍然有必要包含早期的厂商前缀方法，以支持旧版本。在渐变的情况下，这包括基于 Webkit 的浏览器的两种方法，这两种方法切换到支持现在的标准方法，但暂时保留供应商前缀。

约定规定 W3C 方法(最终的、预期的标准)在声明中放在最后，供应商前缀的版本放在它的前面。所有浏览器的完整声明如下:

```html
body {
background-image: -o-linear-gradient(bottom, rgb(167,9,246) 11%, rgb(194,242,242) 56%);
background-image: -moz-linear-gradient(bottom, rgb(167,9,246) 11%, rgb(194,242,242) 56%);
background-image: -webkit-linear-gradient(bottom, rgb(167,9,246) 11%, rgb(194,242,242) 56%);
background-image: -ms-linear-gradient(bottom, rgb(167,9,246) 11%, rgb(194,242,242) 56 %);
background-image: -webkit-gradient(linear, left bottom, left top,
color-stop(0.11, rgb(167,9,246)),
color-stop(0.56, rgb(194,242,242)) );
background-image: linear-gradient(to top, rgb(167,9,246) 11%, rgb(194,242,242) 56%);
}
```

由于浏览器只关注他们理解的 CSS，而忽略任何他们不理解的 CSS，Safari 和 Chrome 将读取适用于该浏览器版本的声明*的-webkit 行并实现它。理解规范最终版本的更高版本的浏览器将读取最后一行。*

浏览器完全有可能同时支持带前缀和不带前缀的 CSS 属性。声明中的外观规则是从左到右、从上到下读取的。在有冲突的情况下，在*之后*规定的规则优先于在*之前规定的规则。*将 W3C 标准放在声明的最后确保了如果浏览器支持它，它将总是优先。

虽然这段代码看起来有些令人生畏，但很明显其中有大量的重复。除了不赞成使用的 Webkit 方法之外，大多数 CSS 声明都可以通过复制和粘贴第一行并在副本前添加供应商前缀来轻松创建。还有自动生成厂商前缀代码的工具和技术，我将在第十章中讨论。

为了在特定的浏览器中获得对实验性 CSS 属性的支持，您必须在样式表中包含适当的供应商前缀和值。只有两个例外:

*   浏览器允许前缀别名(将在下一节讨论)。
*   浏览器遵循最终的 W3C 标准，不需要前缀。

令人欣慰的是，CSS 变换、过渡和动画的属性和值从模块开始就已经被广泛认同；在撰写本文时，所有当前的浏览器都以相同的方式实现代码，尽管带有供应商前缀。

![image](img/sq.jpg) **注**2012 年 6 月 6 日，W3C 最终确定了过渡、动画和转换的规范，并同意让所有浏览器厂商支持它们，而不使用厂商前缀。Internet Explorer 10 是第一个这样做的浏览器，预计其他浏览器将很快跟进。旧版本的浏览器仍然需要供应商前缀。

供应商前缀问题

虽然供应商前缀系统可以工作，但它确实有几个问题。异常和边缘情况可能很难跟踪和记忆。例如，在所有浏览器中实现段落断字的最佳当前解决方案如下:

```html
p { −ms-word-break: break-all; word-break: break-all; word-break: break-word;
-moz-hyphens: auto; -webkit-hyphens: auto; hyphens: auto; hyphenate: auto;  }
```

正如您所看到的，前面的一些 CSS 声明使用了供应商前缀，但是属性名称和值最终与 W3C 建议不匹配，并且不同的浏览器使用其他属性。

此外，一些浏览器供应商倾向于保留他们的专有前缀，并且在标准达成一致后不弃用它们，要求开发人员维护遗留的带前缀的 CSS 代码。

最后，懒惰的开发人员倾向于只实现一个或两个供应商前缀，忽略了在他们自己的规范版本下提供同等支持的其他浏览器。例如，许多开发人员会在他们的样式表中包含-moz 和-webbkit 前缀属性，但忘记添加-ms 或-o。因此，一些浏览器——最明显的是 Opera 的最新版本——能够识别其他供应商前缀。在 Opera 的情况下，这意味着一些-webkit 前缀属性。

![image](img/sq.jpg) **注意**因为一个包含所有厂商前缀的完整 CSS 声明可能会很长，所以本书中的代码示例通常只使用最终的预期规范。如果你想在所有浏览器中获得完全的向后兼容性，在大多数情况下，你不应该将前缀属性局限于你在这里看到的例子。

CSS3 浏览器支持

带有供应商前缀的以下浏览器版本完全支持 CSS3 转换:

*   Internet Explorer 9 (IE10 不需要前缀)
*   Firefox 3.5 及以上版本
*   Chrome 4 及以上版本
*   Safari 3.1 及更高版本
*   Opera 10.5 及以上版本
*   iOS Safari 3.2 及以上版本
*   歌剧移动 11
*   Android 2.1 及以上版本

带有供应商前缀的以下浏览器版本完全支持 CSS3 转换:

*   Firefox 4 及以上版本
*   Chrome 4 及以上版本
*   Safari 3.1 及更高版本
*   Opera 10.5 及以上版本
*   iOS Safari 3.2 及以上版本
*   Opera Mobile 10
*   Android 2.1 及以上版本

Internet Explorer 10 支持不带前缀的转换；其他浏览器的最新版本也会这样做。

带有供应商前缀的以下浏览器版本完全支持 CSS3 动画工作草案:

*   火狐 5 及以上版本
*   Chrome 4 及以上版本
*   Safari 4 及以上版本
*   Opera 12 及以上
*   iOS Safari 3.2 及以上版本
*   Android 4.0 及以上(2.1 起部分支持)

同样，Internet Explorer 10 支持不带前缀的 CSS 动画。

![image](img/sq.jpg) **提示** `www.caniuse.com`是跟踪浏览器对 CSS3 支持的极好资源。

CSS3 动画 的局限性

虽然 CSS3 的变换、过渡和动画非常强大，但有几个属性是它们不能影响的，至少目前不能:

*   CSS3 不能控制滚动条或“滚动”整个文档
*   渐变不能被动画化(尽管这可以通过 SVG 或 JavaScript 来实现)。

设计原则:渐进增强和优雅退化

CSS 和 JavaScript 共有的设计方法之一是*优雅退化*，也称为*渐进增强*。简单地说，这个想法是用 CSS 来*增强*一个网站，而不是让网站完全依赖于它。

当您开始制作动画内容时，这变得尤其重要。因为 CSS3 只在某些浏览器中受支持，所以在应用高级技术时，你应该总是问:“如果浏览器没有显示我试图实现的内容，网站还能使用吗？”

这对于一些人来说是有问题的，尤其是客户，他们坚持认为一个站点应该“在每个浏览器中看起来和执行起来完全一样”然而，在 iPhone 和响应式网页设计的时代，这不再是一个现实的期望。相反，您需要将向站点添加高级 CSS 视为一系列假设场景:

*   如果你用 CSS3 在网页上制作图像幻灯片(如第六章所示)，浏览器不支持，会发生什么？如果用户看到一个静态的占位符图像来代替幻灯片，这样可以吗？还是需要使用 JavaScript 作为退路？
*   如果你用 CSS3 来增强一个站点的导航条的动画效果，一些用户看不到动画效果可以吗？没有导航条他们还能用吗？

本书中的各种示例和教程将展示实现向后兼容性的不同解决方案，因为没有一种实践或技术适用于所有情况。同时，我也会强调可访问性；也就是说，允许具有不同需求和能力的用户(例如盲人或使用键盘而不使用鼠标的网站访问者)访问您的作品。

为什么是 CSS3 而不是 JavaScript 或 Flash？

你可以在表 1-2 中找到使用 CSS3 而不是 JavaScript 或 Flash 的优缺点的综合列表。

表 1-2 。CSS3 与 JavaScript 和 Flash

| CSS3 |
| :-: |
| **优势** | **缺点** |
| 建立在熟悉的基础上；使用既定的 CSS 语法。简单易懂。 | 虽然 Firefox、Safari 和 Chrome 在历史上提供了良好的支持，但 IE 和 Opera 的兼容性仅限于最近的版本。 |
| 浏览器中最快、最流畅的动画形式，帧速率高于 JavaScript。 | 创建动画代码的图形工具相对较少，这就需要一定程度的手工编码。(虽然这正在改变；参见第十章。) |
| 操纵现有的 HTML 内容，增强搜索引擎优化。 |
| 闪光 |
| **优势** | **缺点** |
| 建立良好的图形用户界面来创建动画。 | 无法在许多移动设备上播放(最重要的是苹果 iPhone 和 iPad 以及 Android 和 Windows 8 设备)。 |
| 循环、变量和函数使 ActionScript (Flash 的脚本语言)比 CSS 更强大。 | 依赖于用户必须定期更新的插件的存在。 |
|  | 倾向于“锁定”内容，使 CSS、搜索引擎机器人、辅助设备(如屏幕阅读器)和公平用例无法访问内容。 |
| **JavaScript** |
| **优势** | **缺点** |
| 支持良好，有许多框架。 | 使用框架需要一个额外的 HTTP 请求，这会降低页面加载时间。 |
| 通过 DOM 和 CSS 操作 HTML 元素，这是任何 web 开发人员都熟悉的。 | 即使有框架，语法也可能有些迟钝。 |
| 循环、变量和函数使这门语言比 CSS 更强大。 | JavaScript 生成的内容不会被搜索引擎编入索引。 |

其他技术

对于其他新的网络技术的角色存在一定程度的混淆，特别是在客户端，所以讨论 CSS3 动画不是什么是值得的。

*   CSS3 不是 HTML5 。虽然这两种技术往往被相提并论，但 CSS3 与 HTML5 无关。标记不是表示:CSS3 同样适用于 XHTML 或 HTML3.1。在本书中，您将使用 HTML5 作为您的标记，但不是必须的。
*   CSS3 不是画布。

    <canvas>是一个 HTML5 元素，在网页上创建一个 JavaScript 可访问的“绘图区域”。表面的位置是由 CSS 定义的，但是其中的任何动画都是由 JavaScript 控制的。</canvas>

*   CSS 3D 变换是 CSS 变换模块的一部分，不是动画。CSS 转换用于操纵 HTML 元素的视觉透视。这些变换可以被动画化，但是 CSS 3D 变换(在第九章中讨论)本身并不是动画。

WebGL 不是 CSS 动画。WebGL 是一个 JavaScript 3D API，它操纵

<canvas>元素中的绘图。</canvas>

摘要

在这一章中，你已经学习了 CSS 是如何被开发和标准化的，以及 W3C 在这个过程中的角色。初学 web 开发的人有时会将 W3C 视为一种良性的霸主，从高处制定标准；事实是，该组织及其各种工作组实际上是浏览器供应商创造的创新的集成者和标准化者。

虽然它们仍处于试验状态，但新的 CSS 属性在如何实现方面仍有待开发。为此，特定于每个浏览器的供应商前缀用于区分浏览器制造商对新 CSS 属性的解释。只有当 W3C 对属性进行了标准化，并且软件中内置了支持时，浏览器才会解释非前缀版本。

虽然 CSS3 动画、过渡和变换相对于 Flash 和 JavaScript 的传统 web 动画解决方案有许多显著的优势，但它们相对较新，限制了它们只能用于相当新的浏览器版本，尤其是在 Internet Explorer 和 Opera 的情况下。在开发过程中考虑回退技术是很重要的，这样使用旧浏览器或依赖屏幕阅读器等辅助设备的用户就不会错过您的站点内容。(同样重要的是将这些问题传达给客户和其他 web 开发人员，当他们试图谈论 web 动画时，可能会经常从外围或不相关的技术(如 HTML5)中进行选择。)

在下一章，我将介绍 CSS 转换的语法以及如何创建 CSS 转换，这是最简单的 CSS3 动画形式。虽然会有一点数学，我们将通过比较 CSS3 动画和真实世界的运动示例，包括迪士尼采用的经典动画技术，来丰富这一点。